<!DOCTYPE html>
<!-- saved from url=(0066)https://www.ibm.com/developerworks/cn/opensource/os-cn-pythonwith/ -->
<html lang="zh-CN" style="" class="applicationcache geolocation history postmessage svg websockets localstorage sessionstorage websqldatabase webworkers hashchange pointerevents canvas audio canvastext video webgl cssgradients multiplebgs opacity rgba inlinesvg hsla supports svgclippaths smil no-touchevents fontface generatedcontent textshadow cssanimations backgroundsize borderimage borderradius boxshadow csscolumns csscolumns-width csscolumns-span csscolumns-fill csscolumns-gap csscolumns-rule csscolumns-rulecolor csscolumns-rulestyle csscolumns-rulewidth csscolumns-breakbefore csscolumns-breakafter csscolumns-breakinside flexbox flexboxlegacy cssreflections csstransforms csstransforms3d csstransitions indexeddb indexeddb-deletedatabase js ibm-v18 ibm-cxtype-4g no-hires win chrome chrome7 webkit webkit5 ibm-grid-xlarge greater-china-imt"><head><meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
	
<meta name="viewport" content="width=device-width, initial-scale=1">      
<link rel="icon" href="https://www.ibm.com/favicon.ico">
<link rel="canonical" href="http://www.ibm.com/developerworks/cn/opensource/os-cn-pythonwith/index.html">
<meta name="geo.country" content="CN">
<meta name="dcterms.rights" content="© Copyright IBM Corporation 2011, 2019">
<meta name="dcterms.date" content="2019-05-05">
<meta name="description" content="硬链接与软链接是 Linux 文件系统中的重要概念，其涉及文件系统中的索引节点 (index node 又称 inode)，而索引节点对象是 Linux 虚拟文件系统 (VFS) 的四个基本概念之一。通过剖析硬链接与软链接的联系与区别，我们能了解 Linux 中 VFS 这一通用文件模型。并让 Linux 普通用户和系统管理员正确使用硬链接与软链接，帮助文件系统开发者获取 inode 的相关知识。">	
<meta name="keywords" content="硬链接, 软链接, 硬连接, 软连接, hard link, symbolic link, inode, tttosca">
<meta name="robots" content="index,follow">
<title>浅谈 Python 的 with 语句</title>
    
<iframe height="0" width="0" src="javascript:&#39;&lt;script&gt;function i(a){new Image().src = a};i(&quot;https://cms.tanx.com/t.gif?tanx_nid=29600513&amp;tanx_cm&amp;ext_data=200020104&quot;);i(&quot;https://cm.pos.baidu.com/pixel?dspid=6418041&amp;ext_data=200020104&quot;);i(&quot;https://cm.g.doubleclick.net/pixel?google_nid=ipy&amp;google_cm&amp;ext_data=200020104&quot;);i(&quot;https://cyes.youku.com/cm.gif?dspid=11112&amp;s=1&amp;ext_data=200020104&quot;);i(&quot;https://cm.fastapi.net/?dspid=100018&amp;gethuid=1&amp;dspuid=G1PH766EsY_&amp;ext_data=200020104&quot;);i(&quot;https://ckm.aty.sohu.com/cm.gif?ver=1&amp;mid=10012&amp;ext_data=200020104&quot;);i(&quot;https://cm.l.qq.com/?dspid=10016&amp;dspuid=G1LIOs21cjIy&amp;gettuid=1&amp;ext_data=200020104&quot;);&lt;/script&gt;&#39;" name="_pycmifr" style="display: none; visibility: hidden;" src="./浅谈 Python 的 with 语句_files/saved_resource.html"></iframe><script id="loadedViaBxAnalytics-HU3dbkAG5wE0F1IkRf9S1RexlAqo3jby" src="./浅谈 Python 的 with 语句_files/analytics.min.js.下载" type="text/javascript" async=""></script><script type="text/javascript" async="" src="./浅谈 Python 的 with 语句_files/adv"></script><script type="text/javascript" async="" src="./浅谈 Python 的 with 语句_files/adv(1)"></script><script type="text/javascript" async="" src="./浅谈 Python 的 with 语句_files/presadv"></script><script type="text/javascript" async="" charset="utf-8" id="utag_148" src="./浅谈 Python 的 with 语句_files/ktag.js.下载"></script><script async="" src="./浅谈 Python 的 with 语句_files/a.js.下载"></script><script type="text/javascript" async="" charset="utf-8" id="utag_136" src="./浅谈 Python 的 with 语句_files/survey.js.下载"></script><script type="text/javascript" async="" charset="utf-8" id="utag_19" src="./浅谈 Python 的 with 语句_files/hotjar-42920.js.下载"></script><script type="text/javascript" async="" charset="utf-8" id="utag_21" src="./浅谈 Python 的 with 语句_files/bat.js.下载"></script><script type="text/javascript" async="" charset="utf-8" id="utag_16" src="./浅谈 Python 的 with 语句_files/f.txt"></script><script type="text/javascript" async="" charset="utf-8" id="utag_53" src="./浅谈 Python 的 with 语句_files/js"></script><script type="text/javascript" async="" charset="utf-8" id="demandbase_js_lib" src="./浅谈 Python 的 with 语句_files/ab057a07.min.js.下载"></script><script type="text/javascript" async="" src="./浅谈 Python 的 with 语句_files/analytics.js.下载"></script><script type="text/javascript" async="" charset="utf-8" id="utag_162" src="./浅谈 Python 的 with 语句_files/js(1)"></script><script type="text/javascript" async="" charset="utf-8" id="tealium_cormetrics2" src="./浅谈 Python 的 with 语句_files/eluminate.js.下载"></script><script src="./浅谈 Python 的 with 语句_files/bluemix-analytics.min.js.下载" type="application/javascript" async=""></script><script type="text/javascript" async="" charset="utf-8" id="dle_api_81740bffe811aa3f1b5dbf73cf16b8f562d4f368e30013eed264337962b390f2" src="./浅谈 Python 的 with 语句_files/p_81740bffe811aa3f1b5dbf73cf16b8f562d4f368e30013eed264337962b390f2.js.下载"></script><script src="./浅谈 Python 的 with 语句_files/utag.js.下载" type="application/javascript" async=""></script><script src="./浅谈 Python 的 with 语句_files/dbdm-data" type="application/javascript" async=""></script><script src="./浅谈 Python 的 with 语句_files/p_81740bffe811aa3f1b5dbf73cf16b8f562d4f368e30013eed264337962b390f2.js(1).下载" type="application/javascript" async=""></script><script src="./浅谈 Python 的 with 语句_files/saved_resource" type="application/javascript" async=""></script><script src="./浅谈 Python 的 with 语句_files/p_devwrks.js.下载" type="application/javascript" async=""></script><script src="./浅谈 Python 的 with 语句_files/p_81740bffe811aa3f1b5dbf73cf16b8f562d4f368e30013eed264337962b390f2.js.下载" type="application/javascript" async=""></script><script> 
    digitalData = {
        "page":{
            "category":{
                "primaryCategory":"SOFDCOSRCN"
            },
            "pageInfo":{
                "effectiveDate":"2011-12-02",
                "language":"zh-CN",
                "publishDate":"2019-05-05",
                "publisher":"IBM Corporation",
                "version":"v18",
                "ibm":{ 
                    "contentDelivery":"IBM developerWorks template",
                    "contentProducer":"IBM developerWorks",
                    "country":"CN",
                    "owner":"developerWorks/China/IBM",
                    "siteID":"DEVWRKS",
                    "subject":"TT400",
                    "type":"CT316",
                    "topic":"Python",
                    "topicId":"46",
                    "contentArea":"opensource",
                    "contentAreaId":"7",
                    "contentType":"article",
                    "contentId":"778639",
                },
                "keywords":"硬链接, 软链接, 硬连接, 软连接, hard link, symbolic link, inode, tttosca",
                "description":"硬链接与软链接是 Linux 文件系统中的重要概念，其涉及文件系统中的索引节点 (index node 又称 inode)，而索引节点对象是 Linux 虚拟文件系统 (VFS) 的四个基本概念之一。通过剖析硬链接与软链接的联系与区别，我们能了解 Linux 中 VFS 这一通用文件模型。并让 Linux 普通用户和系统管理员正确使用硬链接与软链接，帮助文件系统开发者获取 inode 的相关知识。"
            }
        }
    };
    window._analytics = {
        "coremetrics": false,
        "optimizely": false,
        "googleAddServices": false,
        "addRoll": false,
        "intercom": false,
        "fullStory": false,
        "hotjar": false,
        "tealeaf": false,
        "nps": false,
        "segment_key": 'HU3dbkAG5wE0F1IkRf9S1RexlAqo3jby'
    };
</script>
	
    <meta name="twitter:card" content="summary">
<meta name="twitter:site" content="@developerworks">
<meta property="og:title" content="浅谈 Python 的 with 语句">
<meta property="og:description" content="硬链接与软链接是 Linux 文件系统中的重要概念，其涉及文件系统中的索引节点 (index node 又称 inode)，而索引节点对象是 Linux 虚拟文件系统 (VFS) 的四个基本概念之一。通过剖析硬链接与软链接的联系与区别，我们能了解 Linux 中 VFS 这一通用文件模型。并让 Linux 普通用户和系统管理员正确使用硬链接与软链接，帮助文件系统开发者获取 inode 的相关知识。">
    <meta property="og:image" content="http://www.ibm.com/developerworks/i/dw-social-201508.png">
<!-- Segment meta tag -->
<meta name="segment" property="developerWorks (developerWorks)" producttitle="developerWorks" value="Open Source Chinese (developerWorks)">      
<!-- SITE MON : START (DO NOT DELETE) -->
<!-- developerWorks monitoring token -->
<!-- SITE MON : END (DO NOT DELETE) -->

<!-- HEADER_SCRIPTS_AND_CSS_INCLUDE -->
<!-- <script src="//cdn.optimizely.com/js/5399420604.js"></script> -->
<!-- BEGIN: Use this section to set page specific variables for the Page Tag -->
<script language="JavaScript">var NTPT_PGEXTRA="ibmSkillLevel=1&ibmCmaId=778639&ibmContentAreas=opensource";</script>
<!--END -->
<script src="./浅谈 Python 的 with 语句_files/ida_stats.js.下载"></script><meta property="og:type" content="website"><meta property="og:url" content="http://www.ibm.com/developerworks/cn/opensource/os-cn-pythonwith/index.html"><meta property="og:locale" content="zh-CN"><meta property="og:published_time" content="2019-05-05"><meta property="article:published_time" content="2019-05-05">
<link href="./浅谈 Python 的 with 语句_files/www.css" rel="stylesheet">
<link href="./浅谈 Python 的 with 语句_files/syntaxhighlighter.css" rel="stylesheet">
<script src="./浅谈 Python 的 with 语句_files/www.js.下载"></script><style></style>
<script src="./浅谈 Python 的 with 语句_files/syntaxhighlighter.js.下载"></script>    
<link href="./浅谈 Python 的 with 语句_files/tables.css" rel="stylesheet">
<script src="./浅谈 Python 的 with 语句_files/tables.js.下载"></script>   
<!--  Masthead/footer  -->
<link href="./浅谈 Python 的 with 语句_files/dw-mf-v18.css" rel="stylesheet">
<!-- <link href="//dw1.s81c.com/developerworks/css/dw-mf/v18/alt-signedin-ux.css" rel="stylesheet" /> -->   
<!--[if lt IE 9]>
    <link href="//dw1.s81c.com/developerworks/css/dw-mf/v18/dw-mf-ie8fix.css?v=022216" rel="stylesheet" />
<![endif]-->
<link href="./浅谈 Python 的 with 语句_files/dw-article.css" rel="stylesheet">
<script src="./浅谈 Python 的 with 语句_files/dw-auth-properties.js.下载"></script>
<script src="./浅谈 Python 的 with 语句_files/dw-auth.js.下载"></script>
<script src="./浅谈 Python 的 with 语句_files/dw-mf.js.下载"></script>
<script src="./浅谈 Python 的 with 语句_files/dw-include.js.下载"></script>     
<script src="./浅谈 Python 的 with 语句_files/dw-article.js.下载"></script>
<script src="./浅谈 Python 的 with 语句_files/dw-auto-links.js.下载"></script>     
<script src="./浅谈 Python 的 with 语句_files/tactic.js.下载"></script>
<script src="./浅谈 Python 的 with 语句_files/tacticbindlinks.js.下载"></script>

<!-- 
<PageMap>
    <DataObject type="document">
        <Attribute name="topic">Python</Attribute>
        <Attribute name="topicId">46</Attribute>
        <Attribute name="contentArea">opensource</Attribute>
        <Attribute name="contentAreaId">7</Attribute>
        <Attribute name="abstract">硬链接与软链接是 Linux 文件系统中的重要概念，其涉及文件系统中的索引节点 (index node 又称 inode)，而索引节点对象是 Linux
            虚拟文件系统 (VFS) 的四个基本概念之一。通过剖析硬链接与软链接的联系与区别，我们能了解 Linux 中 VFS 这一通用文件模型。并让 Linux
            普通用户和系统管理员正确使用硬链接与软链接，帮助文件系统开发者获取 inode 的相关知识。 </Attribute>
        <Attribute name="pub.date">2019-05-05</Attribute>
        <Attribute name="contentType">article</Attribute>
    </DataObject>
</PageMap>
-->        

<style id="ibm-masthead-hidelinks">@media screen and (max-width: 457px) { .ibm-masthead-categories,#ibm-megamenu-sections{display:none} }</style><style id="ibm-sitenav-menu-hidelinks">@media screen and (max-width: 437.75px) {.ibm-sitenav-menu-container .ibm-sitenav-menu-list > ul > li {display:none}}@media screen and (min-width: 438.75px) {.ibm-mobilemenu-sitenavmenu > ul > li {display:none}}</style><script type="text/javascript" async="" charset="utf-8" id="utag_ibm.web_28" src="./浅谈 Python 的 with 语句_files/utag.28.js.下载"></script><script type="text/javascript" async="" charset="utf-8" id="utag_ibm.web_53" src="./浅谈 Python 的 with 语句_files/utag.53.js.下载"></script><script type="text/javascript" async="" charset="utf-8" id="utag_ibm.web_45" src="./浅谈 Python 的 with 语句_files/utag.45.js.下载"></script><script type="text/javascript" async="" charset="utf-8" id="utag_ibm.web_16" src="./浅谈 Python 的 with 语句_files/utag.16.js.下载"></script><script type="text/javascript" async="" charset="utf-8" id="utag_ibm.web_19" src="./浅谈 Python 的 with 语句_files/utag.19.js.下载"></script><script type="text/javascript" async="" charset="utf-8" id="utag_ibm.web_21" src="./浅谈 Python 的 with 语句_files/utag.21.js.下载"></script><script type="text/javascript" async="" charset="utf-8" id="utag_ibm.web_94" src="./浅谈 Python 的 with 语句_files/utag.94.js.下载"></script><script type="text/javascript" async="" charset="utf-8" id="utag_ibm.web_136" src="./浅谈 Python 的 with 语句_files/utag.136.js.下载"></script><script type="text/javascript" async="" charset="utf-8" id="utag_ibm.web_143" src="./浅谈 Python 的 with 语句_files/utag.143.js.下载"></script><script type="text/javascript" async="" charset="utf-8" id="utag_ibm.web_148" src="./浅谈 Python 的 with 语句_files/utag.148.js.下载"></script><style type="text/css">@media only screen and (max-width:480px){.truste_box_overlay{width: 100%!important;margin: 0px!important;max-width: 100%!important;box-shadow: rgb(0,0,0,0.2) 0px 0px 16px 2px!important;}}@media only screen and (min-width:481px){.truste_box_overlay{width: 80%!important;margin: 20px auto!important;max-width: 800px!important;box-shadow: rgb(0,0,0,0.2) 0px 0px 16px 2px!important;}}</style><script src="./浅谈 Python 的 with 语句_files/f(1).txt"></script><style type="text/css" class="jquery-comments-css">.jquery-comments ul.navigation li.active:after {background: #2793e6 !important;</style><style type="text/css" class="jquery-comments-css">.jquery-comments ul.navigation ul.dropdown li.active {background: #2793e6 !important;</style><style type="text/css" class="jquery-comments-css">.jquery-comments .highlight-background {background: #2793e6 !important;</style><style type="text/css" class="jquery-comments-css">.jquery-comments .highlight-font {color: #2793e6 !important;}</style><style type="text/css" class="jquery-comments-css">.jquery-comments .highlight-font-bold {color: #2793e6 !important;font-weight: bold;}</style><script language="javascript" type="text/javascript" src="./浅谈 Python 的 with 语句_files/50200000.js.下载"></script><script language="javascript" type="text/javascript" src="./浅谈 Python 的 with 语句_files/52640000.js.下载"></script><script type="text/javascript" async="" charset="utf-8" id="tealium_visitor_service_45main" src="./浅谈 Python 的 with 语句_files/016ebba79bf20083275be2d827d003073004206b00bd0"></script><script language="javascript" type="text/javascript" src="./浅谈 Python 的 with 语句_files/cookie-id.js.下载"></script><script language="javascript" type="text/javascript" src="./浅谈 Python 的 with 语句_files/rules_50200000.js.下载"></script><script language="javascript" type="text/javascript" src="./浅谈 Python 的 with 语句_files/rules_52640000.js.下载"></script><script language="javascript" type="text/javascript" src="./浅谈 Python 的 with 语句_files/dispatcher-v3.js.下载"></script><script language="javascript" type="text/javascript" src="./浅谈 Python 的 with 语句_files/cookie-id.js.下载"></script><script src="./浅谈 Python 的 with 语句_files/yahoo-min.js.下载" type="text/javascript"></script><script src="./浅谈 Python 的 with 语句_files/cp-v3.js.下载" type="text/javascript"></script><script type="text/javascript" async="" charset="utf-8" id="tealium_visitor_service_45main" src="./浅谈 Python 的 with 语句_files/016ebba79bf20083275be2d827d003073004206b00bd0(1)"></script><script src="./浅谈 Python 的 with 语句_files/json-min.js.下载" type="text/javascript"></script><style type="text/css">.truste_cookie_prefs,#teconsent{display:none !important}</style></head>
<body id="ibm-com" class="ibm-type ibm-sitenav-menu dw-mast-banner">
	
<div id="ibm-top" class="ibm-landing-page">

<!-- MASTHEAD_BEGIN -->
<div id="ibm-masthead" role="banner" aria-label="IBM" class="ibm-mhtype-minimal">
    <div id="ibm-universal-nav" class="">    
  
        <nav role="navigation" aria-label="IBM">
            <div id="ibm-home"><a href="https://www.ibm.com/cn/zh/?lnk=m">IBM®</a></div>
            <ul id="ibm-menu-links" role="toolbar" aria-label="站点地图" class="ibm-hide">
                <li><a href="https://www.ibm.com/sitemap/cn/zh/">站点地图</a></li>
            </ul><div class="ibm-masthead-rightside"><div id="ibm-search-module" role="search" aria-labelledby="ibm-masthead" class="ibm-has-scope">
            <div class="ibm-masthead-search-close"><p class="ibm-ind-link ibm-icononly ibm-padding-bottom-0"><a href="https://www.ibm.com/developerworks/cn/opensource/os-cn-pythonwith/#" class="ibm-close-link ibm-nospacing">关闭</a></p></div><form id="ibm-search-form" action="https://www.ibm.com/Search/" method="get" aria-labelledby="ibm-masthead">
                <p>
                    <label for="q">IBM</label>
                    <input type="text" maxlength="100" value="" placeholder="搜索" name="q" id="q" aria-label="搜索 IBM Developer" autocomplete="off" role="combobox" aria-autocomplete="list" aria-expanded="false" aria-owns="ibm-search-typeahead-container"><input name="lnk" type="hidden" value="mhsrch">
                    <input type="hidden" value="utf" name="en">
                    <input type="hidden" value="zh" name="lang">
                    <input type="hidden" value="cn" name="cc">
                    <input type="hidden" value="20" name="nr">
                    <input type="hidden" value="For developers" name="tabType[0]">
                    <span class="ibm-search-scope ibm-fadeout" aria-expanded="true"><input class="ibm-styled-checkbox" data-init="false" type="checkbox" name="sn" value="" id="ibm-mh-scopeoption"> <label for="ibm-mh-scopeoption">In Marketplace</label></span><button role="button" type="submit" id="ibm-search" class="ibm-search-link" value="提交"><span class="ibm-access">提交</span></button>
                </p>
            </form><form class="ibm-hide" id="ibm-default-scope-form" action="https://www.ibm.com/search" method="get"><input name="lang" type="hidden" value="zh"><input name="cc" type="hidden" value="cn"><input name="tabType[0]" type="hidden" value="Products"><input name="q" type="text" value=""><input name="lnk" type="hidden" value="mhmpsrch"></form>
        </div><div id="ibm-search-typeahead-container" aria-expanded="true" class="ibm-search-typeahead-container ibm-fadeout"></div><ul aria-label="Tools" role="menubar" class="ibm-masthead-iconsonly"><li role="presentation" class="ibm-masthead-item-signin"><button role="button" aria-haspopup="true" aria-owns="ibm-signin-minimenu-container" class="ibm-profile-link">我的 IBM</button><ul id="ibm-signin-minimenu-container" role="menu" aria-label="Profile" class="ibm-dropdown-menu">    <li class="ibm-dropdown-menu-primary" role="presentation" data-linktype="notifications">       <a class="" href="https://myibm.ibm.com/dashboard/?lnk=mmi" tabindex="0">我的 IBM</a>     </li>    <li class="ibm-dropdown-menu-primary menu-heading" role="presentation">       <span tabindex="0">IBM Developer</span>     </li>   <li class="ibm-dropdown-menu-primary ibm-signin-alt" role="presentation">     <a href="https://www.ibm.com/developerworks/dwwi/jsp/ssologin.jsp?d=https%3A%2F%2Fwww.ibm.com%2Fdeveloperworks%2Fcn%2Fopensource%2Fos-cn-pythonwith%2F&amp;lang=zh&amp;a=dwmav" role="menuitem">登录</a>   </li>   <li class="ibm-dropdown-menu-primary dw-register-alt" role="presentation">     <a href="https://www.ibm.com/developerworks/dwwi/jsp/ssoregister.jsp?d=https%3A%2F%2Fwww.ibm.com%2Fdeveloperworks%2Fcn%2Fopensource%2Fos-cn-pythonwith%2F&amp;lang=zh&amp;a=dwmav" role="menuitem">注册</a>   </li></ul></li><li role="presentation" class="ibm-masthead-item-menu"><button role="button" aria-haspopup="true" aria-owns="ibm-burger-menu-container" class="ibm-menu-link">站点导航</button></li></ul></div> 
        </nav>
  
        
       
    </div>
</div><div class="ibm-mobilemenu ibm-hide" id="ibm-burger-menu-container" aria-labelledby="ibm-burgermenu-a11y" role="dialog" tabindex="0"><p class="ibm-hide" id="ibm-burgermenu-a11y">站点导航</p><div class="ibm-mobilemenu-close"><p class="ibm-icononly ibm-fright ibm-ind-link ibm-nospacing"><a class="ibm-close-link" href="https://www.ibm.com/developerworks/cn/opensource/os-cn-pythonwith/?lnk=hm#">关闭</a></p></div><div class="ibm-mobilemenu-section ibm-mobilemenu-sitenavmenu"><ul role="menubar"><li class="ibm-mobile-section-heading ibm-mobile-sitename">
        <a href="https://www.ibm.com/developerworks/cn/?lnk=hm">IBM Developer</a>
    </li>
            <li role="presentation">
                <a href="https://www.ibm.com/developerworks/cn/topics/?lnk=hm" role="menuitem" tabindex="0">学习</a>
            </li>
            <li role="presentation">
                <a href="https://www.ibm.com/developerworks/cn/downloads/?lnk=hm" role="menuitem" tabindex="-1">开发</a>
            </li>
            <li role="presentation">
                <!-- <a href="//www.ibm.com/developerworks/cn/community/" role="menuitem">社区</a> -->
                <a href="https://www.ibm.com/developerworks/community/groups/service/html/communityview?communityUuid=3302cc3b-074e-44da-90b1-5055f1dc0d9c&amp;lnk=hm" role="menuitem" tabindex="-1">社区</a>
            </li>
            <li class="ibm-sitenav-menu-item-right">
                <a href="https://www.ibm.com/ibm/cn/partners/start/?lnk=hm" role="menuitem" tabindex="-1">合作</a>
            </li>
        </ul></div><div class="ibm-mobilemenu-section"><ul class="ibm-mobilemenu-mhlinks" aria-label="发现 IBM"><li><div data-widget="showhide" data-type="panel" class="ibm-show-hide ibm-widget-processed"><h2><a href="javascript:void();">产品</a></h2><div class="ibm-container-body" style="display: none;"><ul><li><a href="https://www.ibm.com/cn-zh/products/?lnk=hmSTW_CN_THP_P7_TL&amp;lnk2=learn_PHP&amp;psrc=none&amp;pexp=def"><span>市场</span></a></li><li><a href="https://www.ibm.com/cn-zh/products/software?lnk=hmmpr_software_solutions_cnzh&amp;lnk2=learn"><span>软件和解决方案</span></a></li><li><a href="https://www.ibm.com/cn-zh/products/trials/?lnk=hmSTW_CN_THP_P9_TL&amp;lnk2=learn_THP&amp;psrc=none&amp;pexp=def"><span>立即免费试用</span></a></li><li><a href="https://www.ibm.com/analytics/cn/zh/?lnk=hmmpr_bua_cnzh&amp;lnk2=learn"><span>大数据与人工智能</span></a></li><li><a href="https://www.ibm.com/cloud-computing/cn/zh?lnk=hmmpr_bucl_cnzh&amp;lnk2=learn"><span>云计算</span></a></li><li><a href="https://www.ibm.com/ibm/cn/cognitive/outthink/?lnk=hmmpr_buce_cnzh&amp;lnk2=learn"><span>认知</span></a></li><li><a href="https://www.ibm.com/cn-zh/internet-of-things?lnk=hmmpr_iot_cnzh&amp;lnk2=learn"><span>物联网</span></a></li><li><a href="https://www.ibm.com/cn-zh/industries?lnk=hmmpr_ind_cnzh&amp;lnk2=learn"><span>行业解决方案</span></a></li><li><a href="https://www.ibm.com/cn-zh/it-infrastructure?lnk=hmmpr_systems_cnzh&amp;lnk2=learn"><span>IT 基础架构</span></a></li><li><a href="https://www.ibm.com/cn-zh/cloud/mobile?lnk=hmmpr_bumf_cnzh&amp;lnk2=learn"><span>移动</span></a></li><li><a href="https://www.ibm.com/cn-zh/security?lnk=hmmpr_buse_cnzh&amp;lnk2=learn"><span>安全</span></a></li><li><a href="https://www.ibm.com/services/cn/zh/watson/explorer.html?lnk=hmmpr_watson_cnzh&amp;lnk2=learn"><span>Watson</span></a></li><li><a href="https://www.ibm.com/watson/cn-zh/health/?lnk=hmmpr_watson_health_cnzh&amp;lnk2=learn"><span>Watson Health</span></a></li><li><a href="https://www.ibm.com/cn-zh/industries/manufacturing/supply-chain-solutions?lnk=hmmpr_watson_smarts_cnzh&amp;lnk2=learn"><span>Watson 智慧供应链</span></a></li></ul></div></div></li><li><div data-widget="showhide" data-type="panel" class="ibm-show-hide ibm-widget-processed"><h2><a href="javascript:void();">服务</a></h2><div class="ibm-container-body" style="display: none;"><ul><li><a href="https://www.ibm.com/services/cn-zh/digital-reinvention/case/index.html?lnk=hm"><span>企业咨询服务</span></a></li><li><a href="https://www.ibm.com/technologyservices/cn/zh/?lnk=hmmse_ts_cnzh&amp;lnk2=learn#technology-outsourcing"><span>技术服务</span></a></li><li><a href="https://www.ibm.com/cn-zh/financing?lnk=hmmse_fin_cnzh&amp;lnk2=learn"><span>融资</span></a></li><li><a href="https://www.ibm.com/cn-zh/industries?lnk=hmmpr_ind_cnzh&amp;lnk2=learn"><span>行业解决方案</span></a></li><li><a href="https://www.ibm.com/training/?lnk=hm"><span>培训与技能 (英文)</span></a></li></ul></div></div></li><li><a href="https://www.ibm.com/cn-zh/industries?lnk=hmmpr_ind_cnzh&amp;lnk1=menu">行业</a></li><li><div data-widget="showhide" data-type="panel" class="ibm-show-hide ibm-widget-processed"><h2><a href="javascript:void();">开发者</a></h2><div class="ibm-container-body" style="display: none;"><ul><li><a href="https://developer.ibm.com/cn/?lnk=hm"><span>IBM 开发者</span></a></li><li><a href="https://www.ibm.com/developerworks/cn/cognitive/?lnk=hm"><span>AI</span></a></li><li><a href="https://www.ibm.com/developerworks/cn/analytics/?lnk=hm"><span>大数据与分析</span></a></li><li><a href="https://developer.ibm.com/cn/blockchain/?lnk=hm"><span>区块链</span></a></li><li><a href="https://www.ibm.com/developerworks/cn/cloud/?lnk=hm"><span>云计算</span></a></li><li><a href="https://www.ibm.com/developerworks/cn/opensource/?lnk=hm"><span>开源技术</span></a></li><li><a href="https://www.ibm.com/ibm/cn/partners/start/?masthead=&amp;lnk=hm"><span>云/AI 合作伙伴</span></a></li><li><a href="https://www.ibm.com/partnerworld/?lnk=hmmdev_pw_cnzh&amp;lnk2=learn"><span>PartnerWorld (英文)</span></a></li></ul></div></div></li><li><a href="https://www.ibm.com/cn-zh/campaign/case-studies?lnk=hm">成功案例</a></li><li><a href="https://www.ibm.com/support/cn/zh/?lnk=hmmsu_cnzh">支持</a></li><li><a href="https://www.ibm.com/employment/cn/?lnk=hmmca_cnzh">工作机会</a></li></ul></div></div><div class="ibm-mhplaceholder ibm-hide"></div><!-- MASTHEAD_END -->
	    
<!-- LAYOUT -->
<div id="ibm-content-wrapper">
    <!-- LEADSPACE_BEGIN -->
    <header role="banner" aria-labelledby="ibm-pagetitle-h1">
        
        <!-- MASTHEAD_SITENAV_BEGIN -->
        <div class="ibm-sitenav-menu-container" data-widgetprocessed="true">
    <div class="ibm-sitenav-menu-name">
        <a href="https://www.ibm.com/developerworks/cn/">IBM Developer</a>
    </div>
    <div class="ibm-sitenav-menu-list">
        <ul role="menubar">
            <li role="presentation">
                <a href="https://www.ibm.com/developerworks/cn/topics/" role="menuitem" tabindex="0">学习</a>
            </li>
            <li role="presentation">
                <a href="https://www.ibm.com/developerworks/cn/downloads/" role="menuitem" tabindex="-1">开发</a>
            </li>
            <li role="presentation">
                <!-- <a href="//www.ibm.com/developerworks/cn/community/" role="menuitem">社区</a> -->
                <a href="https://www.ibm.com/developerworks/community/groups/service/html/communityview?communityUuid=3302cc3b-074e-44da-90b1-5055f1dc0d9c" role="menuitem" tabindex="-1">社区</a>
            </li>
            <li class="ibm-sitenav-menu-item-right">
                <a href="https://www.ibm.com/ibm/cn/partners/start/" role="menuitem" tabindex="-1">合作</a>
            </li>
        </ul>
    </div>
</div>
<!-- BEGIN IBM DEVELOPER BANNER -->
<!-- <style>
    #dw-mast-banner {
        background: #000;
        box-sizing: border-box;
    }
    #dw-mast-banner.ibm-band, #dw-mast-strip.ibm-band { padding: 0; }
    #dw-mast-banner p { color: #ffffff; margin-left: 1rem; display: inline-block; text-decoration: none; font-size: 1.125rem; }
    #dw-mast-banner .dw-mast-banner-cta { padding-left: 10px; color: #ed1c24; }
    #dw-mast-banner .dw-mast-banner-cta::after { content: "\003e"; color: #ed1c24; font-size: 0.875rem; padding-left: 4px; }
    #dw-mast-banner img { display: inline-block; vertical-align: middle; margin-top: -4px; }
    #dw-mast-banner .dw-mast-banner-img { margin-left: 16px; }
    #dw-mast-strip {
        background-color: #e9e9e9;
        box-sizing: border-box;
    }
    #dw-mast-strip p { padding: 10px 20px 10px; margin-left: 2rem; color: #000; display: block; text-decoration: none; font-size: 1rem; }

    @media only screen and (max-width:800px) {
    #dw-mast-banner p { margin-right: 1rem; }
    }
    @media only screen and (max-width:525px) {
    #dw-mast-banner .dw-mast-banner-cta { padding-left: 4px; }
    }
</style>
<div id="dw-mast-banner" class="ibm-band" style="text-align: center">
    <a href="https://www.ibm.com/cn-zh/cloud/redhat">
        <div style="display:inline-block">
            <img src="https://dw1.s81c.com/developerworks/i/dw-ibmred.png" height="60" width="201" alt="IBM and Red Hat logos"/>
            <p class="ibm-plex-sans-semibold">IBM 和 Red Hat - 开放创新的新篇章。 <span class="dw-mast-banner-cta ibm-plex-sans-semibold">了解更多</span></p>
        </div>
    </a>
</div> -->
<!-- <div id="dw-mast-strip" class="ibm-band" style="text-align: center">
    <div>
        <p>developerWorks 中国 正在向 IBM Developer 过渡。 我们将为您呈现一个全新的界面和更新的主题领域，并一如既往地提供您希望获得的精彩内容。</p>
    </div>
</div> -->
<!-- <div class="code_adorn_announcement" id="code_announcement">
  <div class="code_content__wrap">
  <style>
    .dc-announcement{
      background: #e9e9e9;
      min-height: 53px;
      box-sizing: border-box;
      padding-top: 10px;
      padding-bottom: 10px;
      border-bottom: 1px solid #1e1e1e;
    }
    .dc-announcement p{
      text-align: center;
      font-size: 1.125rem;
      line-height: 1.625rem;
      font-weight: 300;
      padding: 0 20px;
    }
    .dc-announcement a p{
      display: table;
      color: #1e1e1e;
      width: auto;
      margin: 0 auto;
    }
    .dc-announcement a {
      text-decoration: none;
      display: block;
      text-align: center;
    }
    .dc-announcement a p strong{
      color: #fff !important;
      padding: 10px 20px !important;
      margin-left: 10px;
      display: inline-block;
      background-color: rgb(0, 98, 255);
      font-weight: 600;
      font-size: 1.2rem;
      margin-top: 10px;
      margin-bottom: 10px;
    }
    .dc-announcement a p span{
      font-weight: 600;
    }
  </style>
  <div class="dc-announcement">
    <a href="https://developer.ibm.com/cn/digitalconference/">
      <p><span>Digital Developer Conference:</span> 专注于云计算和人工智能的免费半天在线会议：欧洲，11 月 14 日 亚洲，11 月 23 日 <strong>立即注册</strong></p>
    </a>
  </div>
</div>
</div> -->
 <style>
    #dw-mast-banner {
        background-color: #000;
        /* min-height: 75px; */
    }
    #dw-mast-banner.ibm-band { padding: 0; position: static; animation: none; }
    #dw-mast-banner .ibm-columns { padding: 0; min-height: 100px; }
    #dw-mast-banner .dw-mast-banner-txt { padding: 15px 20px 0; color: #4ca7a5; display: inline; }
    #dw-mast-banner .dw-mast-banner-cta { padding: 14px 0 0 20px; margin-right: 2rem; color: #4ca7a5; display: inline; }
    #dw-mast-banner .dw-mast-banner-txt p.ibm-h4 { font-size: 1.125rem; }
    #dw-mast-banner .dw-mast-banner-txt span { white-space: nowrap; }
    #dw-mast-banner .ibm-btn-pri {
        background-color: #000;
        border: 1px solid #4ca7a5;
        color: #4ca7a5;
    }
    #dw-mast-banner .ibm-btn-pri:hover {
        background-color: #4ca7a5;
        color: #fff;
    }
    @media only screen and (max-width:1100px) {
        #dw-mast-banner .dw-mast-banner-cta { padding: 10px 0 0 20px; }
        #dw-mast-banner .dw-mast-banner-txt p.ibm-h4 { font-size: 1.0rem; }
    }
    @media only screen and (max-width:999px) {
        #dw-mast-banner .dw-mast-banner-txt { margin-left: 0.5rem; }
        #dw-mast-banner .dw-mast-banner-cta { margin-right: 0.5rem; }
    }
    @media only screen and (max-width:959px) {
        #dw-mast-banner .dw-mast-banner-txt { margin-left: 2rem; }
        #dw-mast-banner .dw-mast-banner-cta { margin-right: 2rem; }
        #dw-mast-banner .ibm-btn-pri { white-space: nowrap; font-size: .875rem; }
        #dw-mast-banner .dw-mast-banner-txt p.ibm-h4 {
            font-size: .9375rem;
            text-align: center;
            font-weight: 400;
        }
    }
    @media only screen and (max-width:600px) {
        #dw-mast-banner .dw-mast-banner-txt { margin-left: 1rem; }
        #dw-mast-banner .dw-mast-banner-cta { margin-right: 1rem; }
    }
    @media only screen and (max-width:579px) {
        #dw-mast-banner .dw-mast-banner-txt, #dw-mast-banner .dw-mast-banner-cta { display: block; }
        #dw-mast-banner .dw-mast-banner-txt { margin-left: 1rem; margin-right: 1rem; }
        #dw-mast-banner .dw-mast-banner-cta { margin-right: 0; text-align: center; }
        #dw-mast-banner .dw-mast-banner-txt p.ibm-h4 { padding: 0; }
        #dw-mast-banner .dw-mast-banner-cta { padding: 10px 0 0 0; }
    }
</style>
<div id="dw-mast-banner" class="ibm-band">
    <div class="ibm-vertical-center">
        <div class="ibm-center-block ibm-vertical-center">
            <div class="dw-mast-banner-txt ibm-plex-sans-regular">
                <p class="ibm-h4">developerWorks 中国 正在向 IBM Developer 过渡。 我们将为您呈现一个全新的界面和更新的主题领域，并一如既往地提供您希望获得的精彩内容。</p>
            </div>
        </div>
    </div>
</div>
        <!-- MASTHEAD_SITENAV_END -->
        
        <!-- NAVIGATION_TRAIL_BEGIN -->
        <div id="ibm-leadspace-head" class="ibm-alternate">
            <div id="ibm-leadspace-body">
                <nav aria-label="Breadcrumb" role="navigation">                     
                            <ul id="dw-navigation-trail" itemscope="" itemtype="http://schema.org/BreadcrumbList"><li itemprop="itemListElement" itemscope="" itemtype="http://schema.org/ListItem"><a itemprop="item" href="https://www.ibm.com/developerworks/cn/topics/"><span itemprop="name">学习</span></a><meta itemprop="position" content="1"></li><li itemprop="itemListElement" itemscope="" itemtype="http://schema.org/ListItem"><a itemprop="item" href="https://www.ibm.com/developerworks/cn/opensource/"><span itemprop="name">Open source</span></a><meta itemprop="position" content="2"></li></ul>
                </nav>
            </div>
        </div>
        <!-- NAVIGATION_TRAIL_END -->
        
    </header>
    <!-- LEADSPACE_END -->
    
    <!-- MAIN_CONTENT_BEGIN -->
    <main role="main" aria-label=""> 
        <div id="ibm-pcon">
            <!-- BEGIN_IBM-CONTENT -->
            <div id="ibm-content">
                <!-- BEGIN_IBM-CONTENT-BODY -->
                <div id="ibm-content-body">
                    <!-- BEGIN_IBM-CONTENT-MAIN -->
                    <div id="ibm-content-main" class="dw-article">                        
                        <!-- BEGIN_INTERIOR-COLUMNS -->
                                <div class="ibm-columns dw-article-toc">
                                    <!-- LEFT_6_2_CONTENT_COLUMN_BEGIN -->  
                                    <div id="dw-article-toc-container" class="ibm-col-6-2">
                                        <div id="dw-article-toc-body" style="width: 380px; height: 604px;" data-widget="scrollable" data-height="604" class="ibm-widget-processed"><div class="nano-content" tabindex="-1" style="right: -17px;">
                                            <h2>内容</h2><div class="ibm-alternate-rule"><hr></div><ul role="directory" aria-label="内容" class="ibm-plain-list"><li class="dw-highlight"><a onclick="tocLink(&#39;#ibm-pagetitle-h1&#39;)" role="link" tabindex="0">概览</a></li><li><a onclick="tocLink(&#39;#1引言outline&#39;)" role="link" tabindex="0">前言</a></li><li class=""><a onclick="tocLink(&#39;#2术语outline&#39;)" role="link" tabindex="0">术语</a></li><li class=""><a onclick="tocLink(&#39;#3基本语法和工作原理outline&#39;)" role="link" tabindex="0">基本语法和工作原理</a></li><li class=""><a onclick="tocLink(&#39;#4自定义上下文管理器outline&#39;)" role="link" tabindex="0">自定义上下文管理器</a></li><li class=""><a onclick="tocLink(&#39;#5contextlib模块outline&#39;)" role="link" tabindex="0">contextlib 模块</a></li><li class=""><a onclick="tocLink(&#39;#6小结outline&#39;)" role="link" tabindex="0">结束语</a></li><li class=""><a onclick="tocLink(&#39;#artrelatedtopics&#39;)" role="link" tabindex="0">相关主题</a></li><li><a onclick="tocLink(&#39;#icomments&#39;)" role="link" tabindex="0">评论</a></li></ul>
                                        </div><div class="nano-pane" style="opacity: 1; visibility: visible; display: none;"><div class="nano-slider" style="height: 587px; transform: translate(0px, 0px);"></div></div></div>
                                    </div>
                                    <!-- LEFT_6_2_CONTENT_COLUMN_END -->
                                    
                                    <!-- CENTER_6_4_CONTENT_COLUMN_BEGIN -->
                                    <div class="ibm-col-6-4">
                                        <h1 id="ibm-pagetitle-h1" class="ibm-h1">浅谈 Python 的 with 语句</h1>
                                        <!-- Article Top Bar -->
                                                <div class="ibm-columns dw-article-topbar">
                                                    <!-- Author and article info. -->
                                                    <div class="ibm-col-6-2 ibm-col-medium-6-4 dw-article-metadata">
                                                        <div class="dw-article-authordate">王 生辉 和 李 骅宸<br><span class="dw-article-pubdate">2011 年 12 月 02 日发布</span><span class="dw-article-divider">/</span><span class="dw-article-updated">更新: 2019 年 5 月 05 日</span></div>
                                                    </div>
                                                    <!-- Social -->
                                                    <div class="ibm-col-6-2 ibm-col-medium-6-4 ibm-col-small-6-2 dw-article-social">
                                                        <!-- Sharing links -->
                                                        <div id="dw-article-share-inline">
                                                            <div class="dw-article-sharelink-inline">
                                                                <div class="ibm-sharethispage"><h4 class="ibm-bold">分享此页面</h4><p class="ibm-icononly"><a class="ibm-weibo-encircled-link" href="https://service.weibo.com/share/share.php?url=http%3A%2F%2Fwww.ibm.com%2Fdeveloperworks%2Fcn%2Fopensource%2Fos-cn-pythonwith%2Findex.html%&amp;title=%E6%B5%85%E8%B0%88%20Python%20%E7%9A%84%20with%20%E8%AF%AD%E5%8F%A5&amp;language=zh_cn" data-id="weibo" onclick="return IBMCore.common.module.sharethispage.gotoUrl(window.open(), this);">Weibo</a><a class="ibm-googleplus-encircled-link" href="https://plus.google.com/share?url=http%3A%2F%2Fwww.ibm.com%2Fdeveloperworks%2Fcn%2Fopensource%2Fos-cn-pythonwith%2Findex.html&amp;t=%E6%B5%85%E8%B0%88%20Python%20%E7%9A%84%20with%20%E8%AF%AD%E5%8F%A5" data-id="googleplus" onclick="return IBMCore.common.module.sharethispage.gotoUrl(window.open(), this);">Google+</a><a class="ibm-email-encircled-link" href="mailto:?subject=%E6%B5%85%E8%B0%88%20Python%20%E7%9A%84%20with%20%E8%AF%AD%E5%8F%A5&amp;body=http%3A%2F%2Fwww.ibm.com%2Fdeveloperworks%2Fcn%2Fopensource%2Fos-cn-pythonwith%2Findex.html" data-id="email" onclick="">用电子邮件发送本页面</a></p></div>
                                                            </div>
                                                        </div>
                                                        <!-- Number of comments and link to comments -->
                                                        <div id="dw-article-cmts">
                                                            <div class="dw-article-cmtslink">
                                                                <a onclick="tocLink(&#39;#icomments&#39;)" href="https://www.ibm.com/developerworks/cn/opensource/os-cn-pythonwith/#icomments" role="link" tabindex="0" aria-label="Comments">
                                                                    <img src="./浅谈 Python 的 with 语句_files/dw-article-cmt-icon.png" width="29" height="29" alt="Comments">
                                                                </a>
                                                            </div>
                                                            <div class="dw-article-cmtslink">
                                                                <a onclick="tocLink(&#39;#icomments&#39;)" href="https://www.ibm.com/developerworks/cn/opensource/os-cn-pythonwith/#icomments" role="link" tabindex="0">
                                                                    <div id="nCmts">7</div>
                                                                </a>
                                                            </div>
                                                        </div>
                                                    </div>
                                                </div>

                                        <!-- Article Body -->
                                        
                                        <h2 id="1引言outline" class="ibm-h2">前言</h2><p>with 语句是从 Python 2.5 开始引入的一种与异常处理相关的功能（2.5 版本中要通过 from __future__ import
                with_statement 导入后才可以使用），从 2.6 版本开始缺省可用（参考 <a href="http://docs.python.org/release/2.6/whatsnew/2.6.html#pep-343-the-with-statement">What's new in Python 2.6?</a> 中 with 语句相关部分介绍）。with
                语句适用于对资源进行访问的场合，确保不管使用过程中是否发生异常都会执行必要的“清理”操作，释放资源，比如文件使用后自动关闭、线程中锁的自动获取和释放等。</p><h2 id="2术语outline" class="ibm-h2">术语</h2><p>要使用 with 语句，首先要明白上下文管理器这一概念。有了上下文管理器，with 语句才能工作。</p><p>下面是一组与上下文管理器和with 语句有关的概念。</p><p><strong>上下文管理协议（Context Management Protocol）</strong>：包含方法 __enter__() 和
                __exit__()，支持</p><p> 该协议的对象要实现这两个方法。</p><p><strong>上下文管理器（Context Manager）</strong>：支持上下文管理协议的对象，这种对象实现了 </p><p> __enter__() 和 __exit__() 方法。上下文管理器定义执行 with 语句时要建立的运行时上下文，</p><p> 负责执行 with 语句块上下文中的进入与退出操作。通常使用 with 语句调用上下文管理器，</p><p> 也可以通过直接调用其方法来使用。</p><p><strong>运行时上下文（runtime context）</strong>：由上下文管理器创建，通过上下文管理器的 __enter__() 和 </p><p> __exit__() 方法实现，__enter__() 方法在语句体执行之前进入运行时上下文，__exit__() 在</p><p> 语句体执行完后从运行时上下文退出。with 语句支持运行时上下文这一概念。</p><p><strong>上下文表达式（Context Expression）</strong>：with 语句中跟在关键字 with 之后的表达式，该表达式</p><p> 要返回一个上下文管理器对象。</p><p><strong>语句体（with-body）</strong>：with 语句包裹起来的代码块，在执行语句体之前会调用上下文管</p><p> 理器的 __enter__() 方法，执行完语句体之后会执行 __exit__() 方法。</p><h2 id="3基本语法和工作原理outline" class="ibm-h2">基本语法和工作原理</h2><p>with 语句的语法格式如下：</p><h5 id="N1008B" class="ibm-h5">清单 1.
                    with
                语句的语法格式</h5><span class="dw-code-nohighlight"><div class="ibm-syntax-container"><div><div id="highlighter_365269" class="syntaxhighlighter  htmlscript"><table border="0" cellpadding="0" cellspacing="0" role="none"><tbody><tr><td class="gutter"><div class="line number1 index0 alt2">1</div><div class="line number2 index1 alt1">2</div></td><td class="code"><div class="container"><div class="line number1 index0 alt2"><code class="htmlscript plain">with context_expression [as target(s)]:</code></div><div class="line number2 index1 alt1"><code class="htmlscript spaces">&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="htmlscript plain">with-body</code></div></div></td></tr></tbody></table></div></div></div></span><p>这里 context_expression 要返回一个上下文管理器对象，该对象并不赋值给 as 子句中的 target(s) ，如果指定了 as
                子句的话，会将上下文管理器的 __enter__() 方法的返回值赋值给 target(s)。target(s)
                可以是单个变量，或者由“()”括起来的元组（不能是仅仅由“,”分隔的变量列表，必须加“()”）。</p><p>Python 对一些内建对象进行改进，加入了对上下文管理器的支持，可以用于 with
                语句中，比如可以自动关闭文件、线程锁的自动获取和释放等。假设要对一个文件进行操作，使用 with 语句可以有如下代码：</p><h5 id="N10097" class="ibm-h5">清单 2.
                    使用 with
                语句操作文件对象</h5><span class="dw-code-nohighlight"><div class="ibm-syntax-container"><div><div id="highlighter_990267" class="syntaxhighlighter  htmlscript"><table border="0" cellpadding="0" cellspacing="0" role="none"><tbody><tr><td class="gutter"><div class="line number1 index0 alt2">1</div><div class="line number2 index1 alt1">2</div><div class="line number3 index2 alt2">3</div><div class="line number4 index3 alt1">4</div></td><td class="code"><div class="container"><div class="line number1 index0 alt2"><code class="htmlscript plain">with open(r'somefileName') as somefile:</code></div><div class="line number2 index1 alt1"><code class="htmlscript spaces">&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="htmlscript plain">for line in somefile:</code></div><div class="line number3 index2 alt2"><code class="htmlscript spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="htmlscript plain">print line</code></div><div class="line number4 index3 alt1"><code class="htmlscript spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="htmlscript plain"># ...more code</code></div></div></td></tr></tbody></table></div></div></div></span><p>这里使用了 with 语句，不管在处理文件过程中是否发生异常，都能保证 with 语句执行完毕后已经关闭了打开的文件句柄。如果使用传统的 try/finally
                范式，则要使用类似如下代码：</p><h5 id="N100A1" class="ibm-h5">清单 3.
                    try/finally
                方式操作文件对象</h5><span class="dw-code-nohighlight"><div class="ibm-syntax-container"><div><div id="highlighter_956679" class="syntaxhighlighter  htmlscript"><table border="0" cellpadding="0" cellspacing="0" role="none"><tbody><tr><td class="gutter"><div class="line number1 index0 alt2">1</div><div class="line number2 index1 alt1">2</div><div class="line number3 index2 alt2">3</div><div class="line number4 index3 alt1">4</div><div class="line number5 index4 alt2">5</div><div class="line number6 index5 alt1">6</div><div class="line number7 index6 alt2">7</div></td><td class="code"><div class="container"><div class="line number1 index0 alt2"><code class="htmlscript plain">somefile = open(r'somefileName')</code></div><div class="line number2 index1 alt1"><code class="htmlscript plain">try:</code></div><div class="line number3 index2 alt2"><code class="htmlscript spaces">&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="htmlscript plain">for line in somefile:</code></div><div class="line number4 index3 alt1"><code class="htmlscript spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="htmlscript plain">print line</code></div><div class="line number5 index4 alt2"><code class="htmlscript spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="htmlscript plain"># ...more code</code></div><div class="line number6 index5 alt1"><code class="htmlscript plain">finally:</code></div><div class="line number7 index6 alt2"><code class="htmlscript spaces">&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="htmlscript plain">somefile.close()</code></div></div></td></tr></tbody></table></div></div></div></span><p>比较起来，使用 with 语句可以减少编码量。已经加入对上下文管理协议支持的还有模块 threading、decimal 等。</p><p><a href="http://www.python.org/dev/peps/pep-0343/">PEP 0343 </a> 对 with
                语句的实现进行了描述。with 语句的执行过程类似如下代码块：</p><h5 id="N100B0" class="ibm-h5">清单 4.
                    with
                语句执行过程</h5><span class="dw-code-nohighlight"><div class="ibm-syntax-container"><div><div id="highlighter_328796" class="syntaxhighlighter  htmlscript"><table border="0" cellpadding="0" cellspacing="0" role="none"><tbody><tr><td class="gutter"><div class="line number1 index0 alt2">1</div><div class="line number2 index1 alt1">2</div><div class="line number3 index2 alt2">3</div><div class="line number4 index3 alt1">4</div><div class="line number5 index4 alt2">5</div><div class="line number6 index5 alt1">6</div><div class="line number7 index6 alt2">7</div><div class="line number8 index7 alt1">8</div><div class="line number9 index8 alt2">9</div><div class="line number10 index9 alt1">10</div><div class="line number11 index10 alt2">11</div><div class="line number12 index11 alt1">12</div><div class="line number13 index12 alt2">13</div><div class="line number14 index13 alt1">14</div><div class="line number15 index14 alt2">15</div><div class="line number16 index15 alt1">16</div><div class="line number17 index16 alt2">17</div><div class="line number18 index17 alt1">18</div><div class="line number19 index18 alt2">19</div><div class="line number20 index19 alt1">20</div><div class="line number21 index20 alt2">21</div></td><td class="code"><div class="container"><div class="line number1 index0 alt2"><code class="htmlscript plain">context_manager = context_expression</code></div><div class="line number2 index1 alt1"><code class="htmlscript plain">exit = type(context_manager).__exit__&nbsp; </code></div><div class="line number3 index2 alt2"><code class="htmlscript plain">value = type(context_manager).__enter__(context_manager)</code></div><div class="line number4 index3 alt1"><code class="htmlscript plain">exc = True&nbsp;&nbsp; # True 表示正常执行，即便有异常也忽略；False 表示重新抛出异常，需要对异常进行处理</code></div><div class="line number5 index4 alt2"><code class="htmlscript plain">try:</code></div><div class="line number6 index5 alt1"><code class="htmlscript spaces">&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="htmlscript plain">try:</code></div><div class="line number7 index6 alt2"><code class="htmlscript spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="htmlscript plain">target = value&nbsp; # 如果使用了 as 子句</code></div><div class="line number8 index7 alt1"><code class="htmlscript spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="htmlscript plain">with-body&nbsp;&nbsp;&nbsp;&nbsp; # 执行 with-body</code></div><div class="line number9 index8 alt2"><code class="htmlscript spaces">&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="htmlscript plain">except:</code></div><div class="line number10 index9 alt1"><code class="htmlscript spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="htmlscript plain"># 执行过程中有异常发生</code></div><div class="line number11 index10 alt2"><code class="htmlscript spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="htmlscript plain">exc = False</code></div><div class="line number12 index11 alt1"><code class="htmlscript spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="htmlscript plain"># 如果 __exit__ 返回 True，则异常被忽略；如果返回 False，则重新抛出异常</code></div><div class="line number13 index12 alt2"><code class="htmlscript spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="htmlscript plain"># 由外层代码对异常进行处理</code></div><div class="line number14 index13 alt1"><code class="htmlscript spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="htmlscript plain">if not exit(context_manager, *sys.exc_info()):</code></div><div class="line number15 index14 alt2"><code class="htmlscript spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="htmlscript plain">raise</code></div><div class="line number16 index15 alt1"><code class="htmlscript plain">finally:</code></div><div class="line number17 index16 alt2"><code class="htmlscript spaces">&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="htmlscript plain"># 正常退出，或者通过 statement-body 中的 break/continue/return 语句退出</code></div><div class="line number18 index17 alt1"><code class="htmlscript spaces">&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="htmlscript plain"># 或者忽略异常退出</code></div><div class="line number19 index18 alt2"><code class="htmlscript spaces">&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="htmlscript plain">if exc:</code></div><div class="line number20 index19 alt1"><code class="htmlscript spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="htmlscript plain">exit(context_manager, None, None, None) </code></div><div class="line number21 index20 alt2"><code class="htmlscript spaces">&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="htmlscript plain"># 缺省返回 None，None 在布尔上下文中看做是 False</code></div></div></td></tr></tbody></table></div></div></div></span><ol type="1"><li>执行 context_expression，生成上下文管理器 context_manager</li><li> 调用上下文管理器的 __enter__() 方法；如果使用了 as 子句，则将 __enter__() 方法的返回值赋值给 as 子句中的 target(s) </li><li> 执行语句体 with-body </li><li> 不管是否执行过程中是否发生了异常，执行上下文管理器的 __exit__() 方法，__exit__()
                    方法负责执行“清理”工作，如释放资源等。如果执行过程中没有出现异常，或者语句体中执行了语句 break/continue/return，则以 None
                    作为参数调用 __exit__(None, None, None) ；如果执行过程中出现异常，则使用 sys.exc_info 得到的异常信息为参数调用
                    __exit__(exc_type, exc_value, exc_traceback)</li><li> 出现异常时，如果 __exit__(type, value, traceback) 返回 False，则会重新抛出异常，让with
                    之外的语句逻辑来处理异常，这也是通用做法；如果返回 True，则忽略异常，不再对异常进行处理 </li></ol><h2 id="4自定义上下文管理器outline" class="ibm-h2">自定义上下文管理器</h2><p>开发人员可以自定义支持上下文管理协议的类。自定义的上下文管理器要实现上下文管理协议所需要的 __enter__() 和 __exit__() 两个方法：</p><ul class="ibm-bullet-list"><li><strong>context_manager.__enter__()</strong> ：进入上下文管理器的运行时上下文，在语句体执行前调用。with
                    语句将该方法的返回值赋值给 as 子句中的 target，如果指定了 as 子句的话</li><li><strong>context_manager.__exit__(exc_type, exc_value, exc_traceback)</strong>
                    ：退出与上下文管理器相关的运行时上下文，返回一个布尔值表示是否对发生的异常进行处理。参数表示引起退出操作的异常，如果退出时没有发生异常，则3个参数都为None。如果发生异常，返回
                        <p>True 表示不处理异常，否则会在退出该方法后重新抛出异常以由 with 语句之外的代码逻辑进行处理。如果该方法内部产生异常，则会取代由
                        statement-body 中语句产生的异常。要处理异常时，不要显示重新抛出异常，即不能重新抛出通过参数传递进来的异常，只需要将返回值设置为
                        False 就可以了。之后，上下文管理代码会检测是否 __exit__() 失败来处理异常 </p></li></ul><p>下面通过一个简单的示例来演示如何构建自定义的上下文管理器。注意，上下文管理器必须同时提供 __enter__() 和 __exit__()
                方法的定义，缺少任何一个都会导致 AttributeError；with 语句会先检查是否提供了 __exit__() 方法，然后检查是否定义了 __enter__()
                方法。</p><p>假设有一个资源 DummyResource，这种资源需要在访问前先分配，使用完后再释放掉；分配操作可以放到 __enter__() 方法中，释放操作可以放到
                __exit__() 方法中。简单起见，这里只通过打印语句来表明当前的操作，并没有实际的资源分配与释放。</p><h5 id="N100DA" class="ibm-h5">清单 5.
                    自定义支持 with
                语句的对象</h5><span class="dw-code-nohighlight"><div class="ibm-syntax-container"><div><div id="highlighter_516296" class="syntaxhighlighter  htmlscript"><table border="0" cellpadding="0" cellspacing="0" role="none"><tbody><tr><td class="gutter"><div class="line number1 index0 alt2">1</div><div class="line number2 index1 alt1">2</div><div class="line number3 index2 alt2">3</div><div class="line number4 index3 alt1">4</div><div class="line number5 index4 alt2">5</div><div class="line number6 index5 alt1">6</div><div class="line number7 index6 alt2">7</div><div class="line number8 index7 alt1">8</div><div class="line number9 index8 alt2">9</div><div class="line number10 index9 alt1">10</div><div class="line number11 index10 alt2">11</div><div class="line number12 index11 alt1">12</div><div class="line number13 index12 alt2">13</div><div class="line number14 index13 alt1">14</div></td><td class="code"><div class="container"><div class="line number1 index0 alt2"><code class="htmlscript plain">class DummyResource:</code></div><div class="line number2 index1 alt1"><code class="htmlscript plain">def __init__(self, tag):</code></div><div class="line number3 index2 alt2"><code class="htmlscript spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="htmlscript plain">self.tag = tag</code></div><div class="line number4 index3 alt1"><code class="htmlscript spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="htmlscript plain">print 'Resource [%s]' % tag</code></div><div class="line number5 index4 alt2"><code class="htmlscript spaces">&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="htmlscript plain">def __enter__(self):</code></div><div class="line number6 index5 alt1"><code class="htmlscript spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="htmlscript plain">print '[Enter %s]: Allocate resource.' % self.tag</code></div><div class="line number7 index6 alt2"><code class="htmlscript spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="htmlscript plain">return self&nbsp;&nbsp; # 可以返回不同的对象</code></div><div class="line number8 index7 alt1"><code class="htmlscript spaces">&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="htmlscript plain">def __exit__(self, exc_type, exc_value, exc_tb):</code></div><div class="line number9 index8 alt2"><code class="htmlscript spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="htmlscript plain">print '[Exit %s]: Free resource.' % self.tag</code></div><div class="line number10 index9 alt1"><code class="htmlscript spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="htmlscript plain">if exc_tb is None:</code></div><div class="line number11 index10 alt2"><code class="htmlscript spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="htmlscript plain">print '[Exit %s]: Exited without exception.' % self.tag</code></div><div class="line number12 index11 alt1"><code class="htmlscript spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="htmlscript plain">else:</code></div><div class="line number13 index12 alt2"><code class="htmlscript spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="htmlscript plain">print '[Exit %s]: Exited with exception raised.' % self.tag</code></div><div class="line number14 index13 alt1"><code class="htmlscript spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="htmlscript plain">return False&nbsp;&nbsp; # 可以省略，缺省的None也是被看做是False</code></div></div></td></tr></tbody></table></div></div></div></span><p>DummyResource 中的 __enter__() 返回的是自身的引用，这个引用可以赋值给 as 子句中的 target
                变量；返回值的类型可以根据实际需要设置为不同的类型，不必是上下文管理器对象本身。</p><p>__exit__() 方法中对变量 exc_tb 进行检测，如果不为 None，表示发生了异常，返回 False
                表示需要由外部代码逻辑对异常进行处理；注意到如果没有发生异常，缺省的返回值为 None，在布尔环境中也是被看做 False，但是由于没有异常发生，__exit__()
                的三个参数都为 None，上下文管理代码可以检测这种情况，做正常处理。</p><p>下面在 with 语句中访问 DummyResource ：</p><h5 id="N100E8" class="ibm-h5">清单 6.
                    使用自定义的支持 with
                语句的对象</h5><span class="dw-code-nohighlight"><div class="ibm-syntax-container"><div><div id="highlighter_736405" class="syntaxhighlighter  htmlscript"><table border="0" cellpadding="0" cellspacing="0" role="none"><tbody><tr><td class="gutter"><div class="line number1 index0 alt2">1</div><div class="line number2 index1 alt1">2</div><div class="line number3 index2 alt2">3</div><div class="line number4 index3 alt1">4</div><div class="line number5 index4 alt2">5</div><div class="line number6 index5 alt1">6</div><div class="line number7 index6 alt2">7</div></td><td class="code"><div class="container"><div class="line number1 index0 alt2"><code class="htmlscript plain">with DummyResource('Normal'):</code></div><div class="line number2 index1 alt1"><code class="htmlscript spaces">&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="htmlscript plain">print '[with-body] Run without exceptions.'</code></div><div class="line number3 index2 alt2">&nbsp;</div><div class="line number4 index3 alt1"><code class="htmlscript plain">with DummyResource('With-Exception'):</code></div><div class="line number5 index4 alt2"><code class="htmlscript spaces">&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="htmlscript plain">print '[with-body] Run with exception.'</code></div><div class="line number6 index5 alt1"><code class="htmlscript spaces">&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="htmlscript plain">raise Exception</code></div><div class="line number7 index6 alt2"><code class="htmlscript spaces">&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="htmlscript plain">print '[with-body] Run with exception. Failed to finish statement-body!'</code></div></div></td></tr></tbody></table></div></div></div></span><p>第1个 with 语句的执行结果如下：</p><h5 id="N100F2" class="ibm-h5">清单 7.
                    with
                语句1执行结果</h5><span class="dw-code-nohighlight"><div class="ibm-syntax-container"><div><div id="highlighter_264288" class="syntaxhighlighter  htmlscript"><table border="0" cellpadding="0" cellspacing="0" role="none"><tbody><tr><td class="gutter"><div class="line number1 index0 alt2">1</div><div class="line number2 index1 alt1">2</div><div class="line number3 index2 alt2">3</div><div class="line number4 index3 alt1">4</div><div class="line number5 index4 alt2">5</div></td><td class="code"><div class="container"><div class="line number1 index0 alt2"><code class="htmlscript plain">Resource [Normal]</code></div><div class="line number2 index1 alt1"><code class="htmlscript plain">[Enter Normal]: Allocate resource.</code></div><div class="line number3 index2 alt2"><code class="htmlscript plain">[with-body] Run without exceptions.</code></div><div class="line number4 index3 alt1"><code class="htmlscript plain">[Exit Normal]: Free resource.</code></div><div class="line number5 index4 alt2"><code class="htmlscript plain">[Exit Normal]: Exited without exception.</code></div></div></td></tr></tbody></table></div></div></div></span><p>可以看到，正常执行时会先执行完语句体 with-body，然后执行 __exit__() 方法释放资源。</p><p>第2个 with 语句的执行结果如下：</p><h5 id="N100FE" class="ibm-h5">清单 8.
                    with
                语句2执行结果</h5><span class="dw-code-nohighlight"><div class="ibm-syntax-container"><div><div id="highlighter_387440" class="syntaxhighlighter  htmlscript"><table border="0" cellpadding="0" cellspacing="0" role="none"><tbody><tr><td class="gutter"><div class="line number1 index0 alt2">1</div><div class="line number2 index1 alt1">2</div><div class="line number3 index2 alt2">3</div><div class="line number4 index3 alt1">4</div><div class="line number5 index4 alt2">5</div><div class="line number6 index5 alt1">6</div><div class="line number7 index6 alt2">7</div><div class="line number8 index7 alt1">8</div><div class="line number9 index8 alt2">9</div><div class="line number10 index9 alt1">10</div></td><td class="code"><div class="container"><div class="line number1 index0 alt2"><code class="htmlscript plain">Resource [With-Exception]</code></div><div class="line number2 index1 alt1"><code class="htmlscript plain">[Enter With-Exception]: Allocate resource.</code></div><div class="line number3 index2 alt2"><code class="htmlscript plain">[with-body] Run with exception.</code></div><div class="line number4 index3 alt1"><code class="htmlscript plain">[Exit With-Exception]: Free resource.</code></div><div class="line number5 index4 alt2"><code class="htmlscript plain">[Exit With-Exception]: Exited with exception raised.</code></div><div class="line number6 index5 alt1">&nbsp;</div><div class="line number7 index6 alt2"><code class="htmlscript plain">Traceback (most recent call last):</code></div><div class="line number8 index7 alt1"><code class="htmlscript spaces">&nbsp;&nbsp;</code><code class="htmlscript plain">File "G:/demo", line 20, in &lt;</code><code class="htmlscript plain">module</code><code class="htmlscript plain">&gt;</code></div><div class="line number9 index8 alt2"><code class="htmlscript spaces">&nbsp;&nbsp;&nbsp;</code><code class="htmlscript plain">raise Exception</code></div><div class="line number10 index9 alt1"><code class="htmlscript plain">Exception</code></div></div></td></tr></tbody></table></div></div></div></span><p>可以看到，with-body 中发生异常时with-body 并没有执行完，但资源会保证被释放掉，同时产生的异常由 with 语句之外的代码逻辑来捕获处理。</p><p>可以自定义上下文管理器来对软件系统中的资源进行管理，比如数据库连接、共享资源的访问控制等。Python 在线文档 <a href="http://docs.python.org/release/2.6/whatsnew/2.6.html#module-contextlib">Writing Context Managers</a> 提供了一个针对数据库连接进行管理的上下文管理器的简单范例。</p><h2 id="5contextlib模块outline" class="ibm-h2">contextlib 模块</h2><p>contextlib 模块提供了3个对象：装饰器 contextmanager、函数 nested 和上下文管理器
                closing。使用这些对象，可以对已有的生成器函数或者对象进行包装，加入对上下文管理协议的支持，避免了专门编写上下文管理器来支持 with 语句。</p><h3 id="N10113" class="ibm-h3">装饰器 contextmanager</h3><p>contextmanager 用于对生成器函数进行装饰，生成器函数被装饰以后，返回的是一个上下文管理器，其 __enter__() 和 __exit__() 方法由
                contextmanager 负责提供，而不再是之前的迭代子。被装饰的生成器函数只能产生一个值，否则会导致异常 RuntimeError；产生的值会赋值给 as
                子句中的 target，如果使用了 as 子句的话。下面看一个简单的例子。</p><h5 id="N1011C" class="ibm-h5">清单 9.
                    装饰器 contextmanager
                使用示例</h5><span class="dw-code-nohighlight"><div class="ibm-syntax-container"><div><div id="highlighter_822909" class="syntaxhighlighter  htmlscript"><table border="0" cellpadding="0" cellspacing="0" role="none"><tbody><tr><td class="gutter"><div class="line number1 index0 alt2">1</div><div class="line number2 index1 alt1">2</div><div class="line number3 index2 alt2">3</div><div class="line number4 index3 alt1">4</div><div class="line number5 index4 alt2">5</div><div class="line number6 index5 alt1">6</div><div class="line number7 index6 alt2">7</div><div class="line number8 index7 alt1">8</div><div class="line number9 index8 alt2">9</div><div class="line number10 index9 alt1">10</div><div class="line number11 index10 alt2">11</div><div class="line number12 index11 alt1">12</div></td><td class="code"><div class="container"><div class="line number1 index0 alt2"><code class="htmlscript plain">from contextlib import contextmanager</code></div><div class="line number2 index1 alt1">&nbsp;</div><div class="line number3 index2 alt2"><code class="htmlscript plain">@contextmanager</code></div><div class="line number4 index3 alt1"><code class="htmlscript plain">def demo():</code></div><div class="line number5 index4 alt2"><code class="htmlscript spaces">&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="htmlscript plain">print '[Allocate resources]'</code></div><div class="line number6 index5 alt1"><code class="htmlscript spaces">&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="htmlscript plain">print 'Code before yield-statement executes in __enter__'</code></div><div class="line number7 index6 alt2"><code class="htmlscript spaces">&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="htmlscript plain">yield '*** contextmanager demo ***'</code></div><div class="line number8 index7 alt1"><code class="htmlscript spaces">&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="htmlscript plain">print 'Code after yield-statement executes in __exit__'</code></div><div class="line number9 index8 alt2"><code class="htmlscript spaces">&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="htmlscript plain">print '[Free resources]'</code></div><div class="line number10 index9 alt1">&nbsp;</div><div class="line number11 index10 alt2"><code class="htmlscript plain">with demo() as value:</code></div><div class="line number12 index11 alt1"><code class="htmlscript spaces">&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="htmlscript plain">print 'Assigned Value: %s' % value</code></div></div></td></tr></tbody></table></div></div></div></span><p>结果输出如下：</p><h5 id="N10126" class="ibm-h5">清单 10.
                    contextmanager
                使用示例执行结果</h5><span class="dw-code-nohighlight"><div class="ibm-syntax-container"><div><div id="highlighter_1954" class="syntaxhighlighter  htmlscript"><table border="0" cellpadding="0" cellspacing="0" role="none"><tbody><tr><td class="gutter"><div class="line number1 index0 alt2">1</div><div class="line number2 index1 alt1">2</div><div class="line number3 index2 alt2">3</div><div class="line number4 index3 alt1">4</div><div class="line number5 index4 alt2">5</div></td><td class="code"><div class="container"><div class="line number1 index0 alt2"><code class="htmlscript plain">[Allocate resources]</code></div><div class="line number2 index1 alt1"><code class="htmlscript plain">Code before yield-statement executes in __enter__</code></div><div class="line number3 index2 alt2"><code class="htmlscript plain">Assigned Value: *** contextmanager demo ***</code></div><div class="line number4 index3 alt1"><code class="htmlscript plain">Code after yield-statement executes in __exit__</code></div><div class="line number5 index4 alt2"><code class="htmlscript plain">[Free resources]</code></div></div></td></tr></tbody></table></div></div></div></span><p>可以看到，生成器函数中 yield 之前的语句在 __enter__() 方法中执行，yield 之后的语句在 __exit__() 中执行，而 yield
                产生的值赋给了 as 子句中的 value 变量。</p><p>需要注意的是，contextmanager 只是省略了 __enter__() / __exit__()
                的编写，但并不负责实现资源的“获取”和“清理”工作；“获取”操作需要定义在 yield 语句之前，“清理”操作需要定义 yield 语句之后，这样 with 语句在执行
                __enter__() / __exit__()
                方法时会执行这些语句以获取/释放资源，即生成器函数中需要实现必要的逻辑控制，包括资源访问出现错误时抛出适当的异常。</p><h3 id="N10130" class="ibm-h3">函数 nested</h3><p>nested 可以将多个上下文管理器组织在一起，避免使用嵌套 with 语句。</p><h5 id="N10139" class="ibm-h5">清单 11.
                    nested
                语法</h5><span class="dw-code-nohighlight"><div class="ibm-syntax-container"><div><div id="highlighter_727574" class="syntaxhighlighter  htmlscript"><table border="0" cellpadding="0" cellspacing="0" role="none"><tbody><tr><td class="gutter"><div class="line number1 index0 alt2">1</div><div class="line number2 index1 alt1">2</div></td><td class="code"><div class="container"><div class="line number1 index0 alt2"><code class="htmlscript plain">with nested(A(), B(), C()) as (X, Y, Z):</code></div><div class="line number2 index1 alt1"><code class="htmlscript spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="htmlscript plain"># with-body code here</code></div></div></td></tr></tbody></table></div></div></div></span><p>类似于：</p><h5 id="N10143" class="ibm-h5">清单 12.
                    nested
                执行过程</h5><span class="dw-code-nohighlight"><div class="ibm-syntax-container"><div><div id="highlighter_897700" class="syntaxhighlighter  htmlscript"><table border="0" cellpadding="0" cellspacing="0" role="none"><tbody><tr><td class="gutter"><div class="line number1 index0 alt2">1</div><div class="line number2 index1 alt1">2</div><div class="line number3 index2 alt2">3</div><div class="line number4 index3 alt1">4</div></td><td class="code"><div class="container"><div class="line number1 index0 alt2"><code class="htmlscript plain">with A() as X:</code></div><div class="line number2 index1 alt1"><code class="htmlscript spaces">&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="htmlscript plain">with B() as Y:</code></div><div class="line number3 index2 alt2"><code class="htmlscript spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="htmlscript plain">with C() as Z:</code></div><div class="line number4 index3 alt1"><code class="htmlscript spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="htmlscript plain"># with-body code here</code></div></div></td></tr></tbody></table></div></div></div></span><p>需要注意的是，发生异常后，如果某个上下文管理器的 __exit__() 方法对异常处理返回 False，则更外层的上下文管理器不会监测到异常。</p><h3 id="N1014B" class="ibm-h3">上下文管理器 closing</h3><p>closing 的实现如下：</p><h5 id="N10154" class="ibm-h5">清单 13.
                    上下文管理 closing
                实现</h5><span class="dw-code-nohighlight"><div class="ibm-syntax-container"><div><div id="highlighter_89476" class="syntaxhighlighter  htmlscript"><table border="0" cellpadding="0" cellspacing="0" role="none"><tbody><tr><td class="gutter"><div class="line number1 index0 alt2">1</div><div class="line number2 index1 alt1">2</div><div class="line number3 index2 alt2">3</div><div class="line number4 index3 alt1">4</div><div class="line number5 index4 alt2">5</div><div class="line number6 index5 alt1">6</div><div class="line number7 index6 alt2">7</div><div class="line number8 index7 alt1">8</div></td><td class="code"><div class="container"><div class="line number1 index0 alt2"><code class="htmlscript plain">class closing(object):</code></div><div class="line number2 index1 alt1"><code class="htmlscript spaces">&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="htmlscript plain"># help doc here</code></div><div class="line number3 index2 alt2"><code class="htmlscript spaces">&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="htmlscript plain">def __init__(self, thing):</code></div><div class="line number4 index3 alt1"><code class="htmlscript spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="htmlscript plain">self.thing = thing</code></div><div class="line number5 index4 alt2"><code class="htmlscript spaces">&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="htmlscript plain">def __enter__(self):</code></div><div class="line number6 index5 alt1"><code class="htmlscript spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="htmlscript plain">return self.thing</code></div><div class="line number7 index6 alt2"><code class="htmlscript spaces">&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="htmlscript plain">def __exit__(self, *exc_info):</code></div><div class="line number8 index7 alt1"><code class="htmlscript spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="htmlscript plain">self.thing.close()</code></div></div></td></tr></tbody></table></div></div></div></span><p>上下文管理器会将包装的对象赋值给 as 子句的 target 变量，同时保证打开的对象在 with-body 执行完后会关闭掉。closing
                上下文管理器包装起来的对象必须提供 close() 方法的定义，否则执行时会报 AttributeError 错误。</p><h5 id="N1015E" class="ibm-h5">清单 14.
                    自定义支持 closing
                的对象</h5><span class="dw-code-nohighlight"><div class="ibm-syntax-container"><div><div id="highlighter_657139" class="syntaxhighlighter  htmlscript"><table border="0" cellpadding="0" cellspacing="0" role="none"><tbody><tr><td class="gutter"><div class="line number1 index0 alt2">1</div><div class="line number2 index1 alt1">2</div><div class="line number3 index2 alt2">3</div><div class="line number4 index3 alt1">4</div><div class="line number5 index4 alt2">5</div><div class="line number6 index5 alt1">6</div><div class="line number7 index6 alt2">7</div><div class="line number8 index7 alt1">8</div><div class="line number9 index8 alt2">9</div><div class="line number10 index9 alt1">10</div><div class="line number11 index10 alt2">11</div><div class="line number12 index11 alt1">12</div></td><td class="code"><div class="container"><div class="line number1 index0 alt2"><code class="htmlscript plain">class ClosingDemo(object):</code></div><div class="line number2 index1 alt1"><code class="htmlscript spaces">&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="htmlscript plain">def __init__(self):</code></div><div class="line number3 index2 alt2"><code class="htmlscript spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="htmlscript plain">self.acquire()</code></div><div class="line number4 index3 alt1"><code class="htmlscript spaces">&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="htmlscript plain">def acquire(self):</code></div><div class="line number5 index4 alt2"><code class="htmlscript spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="htmlscript plain">print 'Acquire resources.'</code></div><div class="line number6 index5 alt1"><code class="htmlscript spaces">&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="htmlscript plain">def free(self):</code></div><div class="line number7 index6 alt2"><code class="htmlscript spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="htmlscript plain">print 'Clean up any resources acquired.'</code></div><div class="line number8 index7 alt1"><code class="htmlscript spaces">&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="htmlscript plain">def close(self):</code></div><div class="line number9 index8 alt2"><code class="htmlscript spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="htmlscript plain">self.free()</code></div><div class="line number10 index9 alt1">&nbsp;</div><div class="line number11 index10 alt2"><code class="htmlscript plain">with closing(ClosingDemo()):</code></div><div class="line number12 index11 alt1"><code class="htmlscript spaces">&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="htmlscript plain">print 'Using resources'</code></div></div></td></tr></tbody></table></div></div></div></span><p>结果输出如下：</p><h5 id="N10168" class="ibm-h5">清单 15.
                    自定义 closing
                对象的输出结果</h5><span class="dw-code-nohighlight"><div class="ibm-syntax-container"><div><div id="highlighter_900630" class="syntaxhighlighter  htmlscript"><table border="0" cellpadding="0" cellspacing="0" role="none"><tbody><tr><td class="gutter"><div class="line number1 index0 alt2">1</div><div class="line number2 index1 alt1">2</div><div class="line number3 index2 alt2">3</div></td><td class="code"><div class="container"><div class="line number1 index0 alt2"><code class="htmlscript plain">Acquire resources.</code></div><div class="line number2 index1 alt1"><code class="htmlscript plain">Using resources</code></div><div class="line number3 index2 alt2"><code class="htmlscript plain">Clean up any resources acquired.</code></div></div></td></tr></tbody></table></div></div></div></span><p>closing 适用于提供了 close() 实现的对象，比如网络连接、数据库连接等，也可以在自定义类时通过接口 close() 来执行所需要的资源“清理”工作。</p><h2 id="6小结outline" class="ibm-h2">结束语</h2><p>本文对 with 语句的语法和工作机理进行了介绍，并通过示例介绍了如何实现自定义的上下文管理器，最后介绍了如何使用 contextlib
                模块来简化上下文管理器的编写。</p><!--CMA ID: 778639--><!--Site ID: 10--><!--XSLT stylesheet used to transform this file: dw-document-html-8.0.xsl-->
                                        <!-- Article Quiz -->
                                        
                                        <!-- Article Resources -->
                                        <div class="ibm-alternate-rule"><hr></div><h4 id="artrelatedtopics" class="ibm-h4">相关主题</h4><ul><li>Python 2.6 版本的 <a href="http://docs.python.org/release/2.6/whatsnew/2.6.html#pep-343-the-with-statement">What's new in Python 2.6?</a> 对 with 语句进行了介绍。</li><li>参看 <a href="http://my.safaribooksonline.com/book/programming/python/9780596513986"><em>Learning Python, Third Edition</em></a> 对异常处理、with
                    语句、以及生成器和装饰器的介绍。</li><li>参看 <a href="http://my.safaribooksonline.com/book/programming/python/0132269937"><em>Core Python Programming, Second Edition</em></a> 对异常处理、with
                    语句、以及生成器和装饰器的介绍。</li><li>Python 在线文档 <a href="http://docs.python.org/release/2.6.6/library/stdtypes.html#typecontextmanager">Context Manager Types</a> 和 <a href="http://docs.python.org/release/2.6.6/reference/datamodel.html#context-managers">With Statement Context Managers</a> 对上下文管理器和 with 语句进行了介绍。</li><li><a href="http://docs.python.org/release/2.6.6/library/contextlib.html">contextlib — Utilities for with-statement contexts</a> 对 contextlib
                    进行了介绍，contextlib 的实现细节可以参看 Python 源码包下的 Lib/contextlib.py 文件。</li><li><a href="http://www.python.org/dev/peps/pep-0343/">PEP 0343</a> 介绍了 with
                    语句的产生背景、规范以及使用。</li><li> 访问 IBM Developer（原 developerWorks）中国 <a href="http://www.ibm.com/developerworks/cn/opensource/">Open source
                    专区</a>获得丰富的 how-to 信息、工具和项目更新，帮助您用开放源码技术进行开发。</li></ul>
                                        <!-- Commenting -->
<!-- INLINE_COMMENTS_BEGIN: -->
<div class="ibm-alternate-rule"><hr></div>
<div id="dw-article-cmts-top" class="ibm-columns">
    <div class="ibm-col-6-2">
        <h4 id="icomments" class="ibm-h4">评论</h4>
        <div id="dw-article-cmts-login">
            <p>添加或订阅评论，请先<a onclick="window.location=userLinks[0].url;" tabindex="0" role="link">登录</a>或<a onclick="window.location=userLinks[1].url;" tabindex="0" role="link">注册</a>。</p>
        </div>
    </div>    
    <div class="ibm-col-6-2" id="dw-notify"> 
        <input type="checkbox" value="1" name="comment_notification" id="comment_notification" disabled="">
        <label for="comment_notification" style="color: rgb(204, 204, 204);">有新评论时提醒我</label>	   
    </div>
</div>

<div class="dw-article-cmts-container">       
    <div class="ibm-no-print jquery-comments read-only" id="dw-icomments-container"><div class="commenting-field main"><img src="./浅谈 Python 的 with 语句_files/user-icon.png" alt="" class="profile-picture round by-current-user"><div class="textarea-wrapper"><span class="close" style="display: none;"><span class="left"></span><span class="right"></span></span><div class="textarea" data-placeholder="添加评论" contenteditable="true" style="height: 3.65em;"></div><div class="control-row" style="display: none;"><span class="send save highlight-background">提交</span></div></div></div><ul class="navigation"><div class="navigation-wrapper"><li data-sort-key="newest" data-container-name="comments" class="active">最新的</li><li data-sort-key="oldest" data-container-name="comments">历史</li><li data-sort-key="popularity" data-container-name="comments">热门</li></div><div class="navigation-wrapper responsive"><li class="title active"><header>最新的</header></li><ul class="dropdown"><li data-sort-key="newest" data-container-name="comments" class="active">最新的</li><li data-sort-key="oldest" data-container-name="comments">历史</li><li data-sort-key="popularity" data-container-name="comments">热门</li></ul></div></ul><div class="data-container" data-container="comments"><ul id="comment-list" class="main"><li data-id="31516" class="comment"><div class="comment-wrapper"><img src="./浅谈 Python 的 with 语句_files/user-icon.png" alt="" class="profile-picture round"><time data-original="1563162863080">2019 年 07 月 15 日</time><div class="name"><a href="https://www.ibm.com/developerworks/community/profiles/user/SpartanBin">SpartanBin</a></div><div class="wrapper"><div class="content">mark</div><span class="actions"><button class="action reply" type="button">回复</button><span class="separator">·</span><button class="action upvote"><span class="upvote-count">0</span><i class="fa fa-thumbs-up"></i></button><span class="separator">·</span><a class="action reply" href="https://www.ibm.com/developerworks/community/report?lang=cn&amp;referingURL=https%3A%2F%2Fwww.ibm.com%2Fdeveloperworks%2Fcn%2Fopensource%2Fos-cn-pythonwith%2F&amp;mymessage=%E8%AF%84%E8%AE%BA%3A%20mark%0D%E7%94%B1%20SpartanBin%20%20%E4%BA%8E%202019%20%E5%B9%B4%2007%20%E6%9C%88%2015%20%E6%97%A5%20%0D%0D---%20%E5%9C%A8%E4%B8%8B%E6%96%B9%E6%B7%BB%E5%8A%A0%E8%AF%84%E8%AE%BA%20---" target="_blank">报告滥用<i class="fa image" style="background-image: url(&quot;/developerworks/maverick/image/report-abuse.png&quot;);"></i></a></span></div></div><ul class="child-comments"></ul></li><li data-id="29943" class="comment"><div class="comment-wrapper"><img src="./浅谈 Python 的 with 语句_files/user-icon.png" alt="" class="profile-picture round"><time data-original="1531920461246">2018 年 07 月 18 日</time><div class="name"><a href="https://www.ibm.com/developerworks/community/profiles/user/hjfshell">hjfshell</a></div><div class="wrapper"><div class="content">mark mark 很详细</div><span class="actions"><button class="action reply" type="button">回复</button><span class="separator">·</span><button class="action upvote"><span class="upvote-count">0</span><i class="fa fa-thumbs-up"></i></button><span class="separator">·</span><a class="action reply" href="https://www.ibm.com/developerworks/community/report?lang=cn&amp;referingURL=https%3A%2F%2Fwww.ibm.com%2Fdeveloperworks%2Fcn%2Fopensource%2Fos-cn-pythonwith%2F&amp;mymessage=%E8%AF%84%E8%AE%BA%3A%20mark%20mark%20%E5%BE%88%E8%AF%A6%E7%BB%86%0D%E7%94%B1%20hjfshell%20%20%E4%BA%8E%202018%20%E5%B9%B4%2007%20%E6%9C%88%2018%20%E6%97%A5%20%0D%0D---%20%E5%9C%A8%E4%B8%8B%E6%96%B9%E6%B7%BB%E5%8A%A0%E8%AF%84%E8%AE%BA%20---" target="_blank">报告滥用<i class="fa image" style="background-image: url(&quot;/developerworks/maverick/image/report-abuse.png&quot;);"></i></a></span></div></div><ul class="child-comments"></ul></li><li data-id="28663" class="comment"><div class="comment-wrapper"><img src="./浅谈 Python 的 with 语句_files/user-icon.png" alt="" class="profile-picture round"><time data-original="1517210919170">2018 年 01 月 29 日</time><div class="name"><a href="https://www.ibm.com/developerworks/community/profiles/user/mr%20tang">mr tang</a></div><div class="wrapper"><div class="content">很厉害</div><span class="actions"><button class="action reply" type="button">回复</button><span class="separator">·</span><button class="action upvote"><span class="upvote-count">0</span><i class="fa fa-thumbs-up"></i></button><span class="separator">·</span><a class="action reply" href="https://www.ibm.com/developerworks/community/report?lang=cn&amp;referingURL=https%3A%2F%2Fwww.ibm.com%2Fdeveloperworks%2Fcn%2Fopensource%2Fos-cn-pythonwith%2F&amp;mymessage=%E8%AF%84%E8%AE%BA%3A%20%E5%BE%88%E5%8E%89%E5%AE%B3%0D%E7%94%B1%20mr%20tang%20%20%E4%BA%8E%202018%20%E5%B9%B4%2001%20%E6%9C%88%2029%20%E6%97%A5%20%0D%0D---%20%E5%9C%A8%E4%B8%8B%E6%96%B9%E6%B7%BB%E5%8A%A0%E8%AF%84%E8%AE%BA%20---" target="_blank">报告滥用<i class="fa image" style="background-image: url(&quot;/developerworks/maverick/image/report-abuse.png&quot;);"></i></a></span></div></div><ul class="child-comments"></ul></li><li data-id="28069" class="comment"><div class="comment-wrapper"><img src="./浅谈 Python 的 with 语句_files/user-icon.png" alt="" class="profile-picture round"><time data-original="1508566867961">2017 年 10 月 21 日</time><div class="name"><a href="https://www.ibm.com/developerworks/community/profiles/user/dasunwarman">dasunwarman</a></div><div class="wrapper"><div class="content">谢谢</div><span class="actions"><button class="action reply" type="button">回复</button><span class="separator">·</span><button class="action upvote"><span class="upvote-count">0</span><i class="fa fa-thumbs-up"></i></button><span class="separator">·</span><a class="action reply" href="https://www.ibm.com/developerworks/community/report?lang=cn&amp;referingURL=https%3A%2F%2Fwww.ibm.com%2Fdeveloperworks%2Fcn%2Fopensource%2Fos-cn-pythonwith%2F&amp;mymessage=%E8%AF%84%E8%AE%BA%3A%20%E8%B0%A2%E8%B0%A2%0D%E7%94%B1%20dasunwarman%20%20%E4%BA%8E%202017%20%E5%B9%B4%2010%20%E6%9C%88%2021%20%E6%97%A5%20%0D%0D---%20%E5%9C%A8%E4%B8%8B%E6%96%B9%E6%B7%BB%E5%8A%A0%E8%AF%84%E8%AE%BA%20---" target="_blank">报告滥用<i class="fa image" style="background-image: url(&quot;/developerworks/maverick/image/report-abuse.png&quot;);"></i></a></span></div></div><ul class="child-comments"></ul></li><li data-id="27230" class="comment"><div class="comment-wrapper"><img src="./浅谈 Python 的 with 语句_files/user-icon.png" alt="" class="profile-picture round"><time data-original="1499084344619">2017 年 07 月 03 日</time><div class="name"><a href="https://www.ibm.com/developerworks/community/profiles/user/clearbug">clearbug</a></div><div class="wrapper"><div class="content">很好，浅显易懂</div><span class="actions"><button class="action reply" type="button">回复</button><span class="separator">·</span><button class="action upvote"><span class="upvote-count">0</span><i class="fa fa-thumbs-up"></i></button><span class="separator">·</span><a class="action reply" href="https://www.ibm.com/developerworks/community/report?lang=cn&amp;referingURL=https%3A%2F%2Fwww.ibm.com%2Fdeveloperworks%2Fcn%2Fopensource%2Fos-cn-pythonwith%2F&amp;mymessage=%E8%AF%84%E8%AE%BA%3A%20%E5%BE%88%E5%A5%BD%EF%BC%8C%E6%B5%85%E6%98%BE%E6%98%93%E6%87%82%0D%E7%94%B1%20clearbug%20%20%E4%BA%8E%202017%20%E5%B9%B4%2007%20%E6%9C%88%2003%20%E6%97%A5%20%0D%0D---%20%E5%9C%A8%E4%B8%8B%E6%96%B9%E6%B7%BB%E5%8A%A0%E8%AF%84%E8%AE%BA%20---" target="_blank">报告滥用<i class="fa image" style="background-image: url(&quot;/developerworks/maverick/image/report-abuse.png&quot;);"></i></a></span></div></div><ul class="child-comments"></ul></li><li data-id="26582" class="comment"><div class="comment-wrapper"><img src="./浅谈 Python 的 with 语句_files/user-icon.png" alt="" class="profile-picture round"><time data-original="1490867643870">2017 年 03 月 30 日</time><div class="name"><a href="https://www.ibm.com/developerworks/community/profiles/user/jiangzx">jiangzx</a></div><div class="wrapper"><div class="content">不错，谢谢！</div><span class="actions"><button class="action reply" type="button">回复</button><span class="separator">·</span><button class="action upvote"><span class="upvote-count">0</span><i class="fa fa-thumbs-up"></i></button><span class="separator">·</span><a class="action reply" href="https://www.ibm.com/developerworks/community/report?lang=cn&amp;referingURL=https%3A%2F%2Fwww.ibm.com%2Fdeveloperworks%2Fcn%2Fopensource%2Fos-cn-pythonwith%2F&amp;mymessage=%E8%AF%84%E8%AE%BA%3A%20%E4%B8%8D%E9%94%99%EF%BC%8C%E8%B0%A2%E8%B0%A2%EF%BC%81%0D%E7%94%B1%20jiangzx%20%20%E4%BA%8E%202017%20%E5%B9%B4%2003%20%E6%9C%88%2030%20%E6%97%A5%20%0D%0D---%20%E5%9C%A8%E4%B8%8B%E6%96%B9%E6%B7%BB%E5%8A%A0%E8%AF%84%E8%AE%BA%20---" target="_blank">报告滥用<i class="fa image" style="background-image: url(&quot;/developerworks/maverick/image/report-abuse.png&quot;);"></i></a></span></div></div><ul class="child-comments"></ul></li><li data-id="24907" class="comment"><div class="comment-wrapper"><img src="./浅谈 Python 的 with 语句_files/user-icon.png" alt="" class="profile-picture round"><time data-original="1463208137352">2016 年 05 月 14 日</time><div class="name"><a href="https://www.ibm.com/developerworks/community/profiles/user/didihe1988">didihe1988</a></div><div class="wrapper"><div class="content">with 语句执行过程说明，当执行with-body出现异常时，先会通过__exit__处理异常，如果__exit__返回True那么忽略异常。如果__exit__返回False，那么向上层抛异常</div><span class="actions"><button class="action reply" type="button">回复</button><span class="separator">·</span><button class="action upvote"><span class="upvote-count">0</span><i class="fa fa-thumbs-up"></i></button><span class="separator">·</span><a class="action reply" href="https://www.ibm.com/developerworks/community/report?lang=cn&amp;referingURL=https%3A%2F%2Fwww.ibm.com%2Fdeveloperworks%2Fcn%2Fopensource%2Fos-cn-pythonwith%2F&amp;mymessage=%E8%AF%84%E8%AE%BA%3A%20with%20%E8%AF%AD%E5%8F%A5%E6%89%A7%E8%A1%8C%E8%BF%87%E7%A8%8B%E8%AF%B4%E6%98%8E%EF%BC%8C%E5%BD%93%E6%89%A7%E8%A1%8Cwith-body%E5%87%BA%E7%8E%B0%E5%BC%82%E5%B8%B8%E6%97%B6%EF%BC%8C%E5%85%88%E4%BC%9A%E9%80%9A%E8%BF%87__exit__%E5%A4%84%E7%90%86%E5%BC%82%E5%B8%B8%EF%BC%8C%E5%A6%82%E6%9E%9C__exit__%E8%BF%94%E5%9B%9ETrue%E9%82%A3%E4%B9%88%E5%BF%BD%E7%95%A5%E5%BC%82%E5%B8%B8%E3%80%82%E5%A6%82%E6%9E%9C__exit__%E8%BF%94%E5%9B%9EFalse%EF%BC%8C%E9%82%A3%E4%B9%88%E5%90%91%E4%B8%8A%E5%B1%82%E6%8A%9B%E5%BC%82%E5%B8%B8%0D%E7%94%B1%20didihe1988%20%20%E4%BA%8E%202016%20%E5%B9%B4%2005%20%E6%9C%88%2014%20%E6%97%A5%20%0D%0D---%20%E5%9C%A8%E4%B8%8B%E6%96%B9%E6%B7%BB%E5%8A%A0%E8%AF%84%E8%AE%BA%20---" target="_blank">报告滥用<i class="fa image" style="background-image: url(&quot;/developerworks/maverick/image/report-abuse.png&quot;);"></i></a></span></div></div><ul class="child-comments"></ul></li></ul><div class="no-comments no-data"><i class="fa fa-comments fa-2x"></i><br>第一个评论</div></div></div>
</div>
<!-- INLINE_COMMENTS_END -->                                        <!-- CENTER_6_4_CONTENT_COLUMN_END -->
                                    </div>   
                                </div>
                        <!--Rating_Meta_BEGIN--><div class="metavalue">static.content.url=http://www.ibm.com/developerworks/js/artrating/</div><div class="metavalue">SITE_ID=10</div><div class="metavalue">Zone=Open source</div><div class="metavalue">ArticleID=778639</div><div class="metavalue">ArticleTitle=浅谈 Python 的 with 语句</div><div class="metavalue">publish-date=05052019</div><script language="javascript" type="text/javascript">document.write('<div class="metavalue">url='+location.href.replace(/</g,  '%3C')+'</div>');</script><div class="metavalue">url=https://www.ibm.com/developerworks/cn/opensource/os-cn-pythonwith/</div><!--Rating_Meta_END-->
                    </div>
                    <!-- END_IBM-CONTENT-MAIN -->
                </div>
                <!-- END_IBM-CONTENT-BODY -->
            </div>
            <!-- END_IBM-CONTENT -->
        </div>
        <!-- END_IBM-PCON -->
    </main>
    <!-- MAIN_CONTENT_END -->
    
    <!-- END_CONTENT-WRAPPER -->	
</div>
<!-- FOOTER_BEGIN -->
<footer role="contentinfo" aria-label="IBM Developer">
    <div id="dw-footer-module" class="dw-footer-home ibmdeveloper">
        <section aria-label="参考资料" role="contentinfo">
            <div class="ibm-columns">
                <div class="ibm-col-6-1 dw-footer-col-1">
                    <ul>
                        <li class="dw-footer-heading" aria-label="IBM Developer"><a href="https://www.ibm.com/developerworks/cn/">IBM <b>Developer</b></a></li>
                        <li><a href="https://www.ibm.com/developerworks/secure/feedback.jsp?domain=dwchina">站点反馈</a></li>
                        <li class="dw-footer-newline"><a href="https://www.ibm.com/developerworks/secure/myideas2.jsp?domain=dwchina">我要投稿</a></li>
                        <li class="dw-footer-newline"><a href="https://www.ibm.com/developerworks/community/report?lang=zh">报告滥用</a></li>
                        <li class="dw-footer-newline"><a href="https://www.ibm.com/developerworks/cn/community/terms/thirdparty/">第三方提示</a></li>
                    </ul>
                    <ul>
                        <li class="dw-footer-newline"><a href="https://weibo.com/ibmdw/">关注微博</a></li>
                    </ul>
                </div>
                <div class="ibm-col-6-1 dw-footer-col-2">
                    <ul>
                        <li class="dw-footer-heading"><a href="https://www-31.ibm.com/ibm/cn/ur/">大学合作</a></li>
                    </ul>
                    <ul class="dw-footer-lang" aria-label="选择语言">
                        <li class="dw-footer-heading">选择语言</li>
                        <li><a href="https://developer.ibm.com/">English</a></li>
                        <li><a href="https://www.ibm.com/developerworks/cn/" lang="zh">中文</a></li>
                        <li><a href="https://www.ibm.com/developerworks/jp/" lang="ja">日本語</a></li>
                        <li><a href="https://www.ibm.com/developerworks/ru/" lang="ru">Русский</a></li>
                        <li class="dw-footer-newline"><a href="https://www.ibm.com/developerworks/br/" lang="pt">Português (Brasil)</a></li>
                        <li><a href="https://www.ibm.com/developerworks/ssa/" lang="es">Español</a></li>
                        <li><a href="https://developer.ibm.com/kr/" lang="kr">한글</a></li>
                    </ul>
                </div>
                <div class="ibm-col-6-1 dw-footer-col-3"> </div>
                <div class="ibm-col-6-1 dw-footer-col-4"> </div>
                <div class="ibm-col-6-1 dw-footer-col-5">
                    <ul class="dw-footer-categories">
                        <li class="dw-footer-category">
                            <a href="https://developer.ibm.com/cn/journey/">Code patterns</a>  
                        </li>
                        <li class="dw-footer-category">
                            <a href="https://www.ibm.com/developerworks/cn/views/global/libraryview.jsp">技术文档库</a>
                        </li>
                        <li class="dw-footer-category">
                            <a href="https://www.ibm.com/developerworks/cn/downloads/">软件下载</a>  
                        </li>
                        <li class="dw-footer-category">
                            <a href="https://developer.ibm.com/cn/">开发者中心</a>  
                        </li>
                        <li class="dw-footer-category">
                            <a href="https://www.ibm.com/developerworks/cn/rss/">订阅源</a>  
                        </li>

                    </ul>
                </div>
                <div class="ibm-col-6-1 dw-footer-col-6">
                    <ul class="dw-footer-categories">
                        <li class="dw-footer-category">
                            <a href="https://www.pages03.net/ibmdeveloperworks/developerWorksChina-NewsletterSubscriptionPage-secure18rev1/">时事通讯</a>  
                        </li>
                        <li class="dw-footer-category">
                            <a href="https://developer.ibm.com/cn/tv/">视频</a>  
                        </li>
                        <li class="dw-footer-category">
                            <a href="https://developer.ibm.com/cn/blogs/">博客</a>  
                        </li>
                        <li class="dw-footer-category">
                            <a href="https://developer.ibm.com/cn/events/">活动</a>  
                        </li>                        
                        <li class="dw-footer-category">
                            <a href="https://www.ibm.com/developerworks/cn/community/">社区</a>  
                        </li>
                    </ul>
                </div>
            </div>
        </section>
    </div>
    <div id="dw-footer" class="ibm-padding-normal ibm-alternate">
        <div class="ibm-columns">
            <div class="ibm-col-1-1">
                <div class="dw-footer-corporate-links">
                <ul>
                    <li><a href="https://www.ibm.com/contact/cn/zh/">联系 IBM</a></li>
                    <li><a href="https://www.ibm.com/privacy/cn/zh/">隐私条约</a></li>
                    <li><a href="https://www.ibm.com/developerworks/cn/community/terms/use/">使用条款</a></li>
                    <li><a href="https://www.ibm.com/accessibility/cn/zh/">信息无障碍选项</a></li>
                    <li class="ibm-feedbacklink"><a href="https://www.ibm.com/developerworks/cn/opensource/os-cn-pythonwith/#">反馈</a></li>
                    <li id="ibm-truste-cp"><a onclick="truste.eu.clickListener();return false;" href="https://www.ibm.com/developerworks/cn/opensource/os-cn-pythonwith/#">Cookie 首选项</a></li>
                </ul>                 
                </div>    
            </div>
        </div>
    </div>        
</footer> <!-- FOOTER_END -->

<!-- END_IBM-TOP -->
</div>

<!-- SCRIPTS_INCLUDE_BEGIN -->
<!-- Styles -->
<link rel="stylesheet" type="text/css" href="./浅谈 Python 的 with 语句_files/jquery-comments.css">
<link rel="stylesheet" href="./浅谈 Python 的 with 语句_files/font-awesome.min.css">

<!-- Libraries -->
<script type="text/javascript" src="./浅谈 Python 的 with 语句_files/jquery-comments.min.js.下载"></script>
<script type="text/javascript" src="./浅谈 Python 的 with 语句_files/moment-with-locales.js.下载"></script>
<script type="text/javascript" src="./浅谈 Python 的 with 语句_files/ContentComments.js.下载"></script>
<script type="text/javascript" src="./浅谈 Python 的 with 语句_files/ContentCommentsFormatter.js.下载"></script>
<script type="text/javascript" language="JavaScript">

	IBMCore.common.module.masthead.subscribe("ready", "customjs", setupCommentsPlugin).runAsap(setupCommentsPlugin);

	function setupCommentsPlugin(){
		//debugger;
			//alert(userLinks);
			var commentsInitInfo = {
				contentId : $("div[class=metavalue]:contains('ArticleID=')").text().split("=")[1],
				siteId :  $("div[class=metavalue]:contains('SITE_ID=')").text().split("=")[1],
				pluginDivId : '#dw-icomments-container',
				notifyElementId : "#comment_notification",
				loginMessageDivId : "#dw-article-cmts-login",
				totalCommentsDivId : "#nCmts",
						isIdea:false

			};				
								
			ContentComments.Setup(commentsInitInfo);
	}
</script>

<!-- SCRIPTS_INCLUDE_END -->



<div id="ibm-overlay-backdrop"></div><div id="ibm-mobilemenu-screen"></div><div id="teconsent" class="truste_cookie_prefs" style="position: fixed; display: none; height: 40px; background-color: #ffffff; z-index: 9999999999; bottom: 0; right: 0; margin: 0; padding: 0 16px; line-height: 40px; vertical-align: middle; box-shadow:0 0 10px 3px rgba(0,0,0,.1)" consent="undefined"><script type="text/javascript" src="./浅谈 Python 的 with 语句_files/notice" id="truste_0.7468558235250764"></script><script async="async" type="text/javascript" crossorigin="" src="./浅谈 Python 的 with 语句_files/v1.7-220"></script><a id="icon-id03494954986042682" tabindex="0" role="button" lang="zh" style="cursor: pointer; font-family: ibm-plex-sans; font-size: 12pt; color: #3d3d3d; text-decoration: none">Cookie 喜好设置</a></div><script async="" src="./浅谈 Python 的 with 语句_files/js(2)" id="mm_pp_background"></script><div style="width:0px; height:0px; display:none; visibility:hidden;" id="batBeacon0.1312840428269677"><img style="width:0px; height:0px; display:none; visibility:hidden;" id="batBeacon0.10410716376325357" width="0" height="0" alt="" src="./浅谈 Python 的 with 语句_files/0"></div><div id="survey-overlay-backdrop" style="opacity: 0.5;background: #111;bottom: 0;left: 0;position: fixed;right: 0; top: 0; z-index: 900; display:none"></div><iframe src="./浅谈 Python 的 with 语句_files/iframe.html" id="mm_sync_back_ground" style="visibility: hidden; display: none;"></iframe><img src="./浅谈 Python 的 with 语句_files/s.gif"><iframe name="trustarc_notice" id="trustarcNoticeFrame" src="./浅谈 Python 的 with 语句_files/get.html" style="display: none;"></iframe></body></html>