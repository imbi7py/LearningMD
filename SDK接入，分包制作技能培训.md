# SDK接入

## 各渠道SDK基本接入方法

各渠道网游SDK基本都包括必选及可选接口：

* 必选接口：初始化、登录、注销、提交玩家数据、支付、退出（有些SDK是可选）

* 可选接口：切换账号（有些SDK是必选）、用户中心等其他接口

### 初始化

SDK的初始化一般都会传入渠道参数，但有些渠道SDK会在配置文件（AndroidManifest）中配置，因而无需传入。

Android一般在AndroidManifest.xml中设置meta-data值，但有些渠道参数会放到assets或者res目录中的某个文件中。

iOS一般在Info.plist中添加字段配置，但也有些渠道会放到资源文件中。

PS：一般各渠道SDK的其他接口都必须在初始化完成之后才能调用。

### 登录
```
客户端调用渠道SDK登录接口->等待结果回调通知->获取结果参数->传递给服务器验证->服务器返回验证结果->客户端登录进入游戏
```
登录接口返回的参数一般有用户ID（uid）、用户名（username）、token/session等，这些参数中部分需要传递给服务器做验证。

### 注销
```
客户端调用渠道SDK注销接口->SDK返回注销成功->客户端注销游戏
```
注销接口调用成功后要及时**清理游戏内数据**使游戏内达到可重新登录的状态。

切换账号接口和注销接口类似，只不过在注销后直接触发了登录。

### 提交玩家数据

有些渠道SDK需要通过此接口获取游戏内的埋点数据：

埋点位置：服务器选择、进入服务器、创建角色、角色升级、退出服务器、退出游戏等；

所需数据：服务器ID、服务器名、角色ID、角色名、角色等级、角色VIP等级、角色剩余货币数、角色战斗力、角色公会名等；

对此接口的调用只需做好游戏中的埋点，触发并传递对应数据到渠道SDK对应接口即可，无需对返回结果又其他操作。

### 支付

```
客户端
调用渠道SDK支付接口->SDK返回支付结果->客户端根据结果进行订单查询
服务器
游戏服务器等待SDK服务器回调支付结果->游戏服务器验证结果后告知SDK服务器结果->设置对应订单状态
```
为了防止各种破解情况，客户端调用SDK支付接口只做支付的发起，所有的验证均在服务器进行，客户端在SDK支付接口调用结束后做出相应的查询即可。

支付接口传入的数据一般有订单号、订单金额、产品ID、产品名、产品描述、产品数量、服务器回调地址等，部分渠道需要再传入与提交玩家数据接口类似的数据，比如服务器ID、服务器名、角色ID、角色名、角色等级、角色VIP等级等。

PS：有些SDK做的比较差的渠道支付接口在客户端是没有回调的，完全依赖服务器的回调出发，因此需要特殊的处理在何时的时机发起订单查询。

### 退出

一般只有Android有退出接口，调用退出接口后依据返回结果退出程序即可。


## Unity与原生代码交互

### Unity与Android交互

由于Android是Java代码，Unity用的是C#代码，两者代码间的交互要采用Jni来实现，具体的Jni调用Unity已经实现只需要调用即可。

### Unity与iOS交互

iOS的工程目前还是Object-C代码为主，与C#其实是同根同源的，因此使用C语言的extern字段来扩展实现调用即可。

PS：具体的参考游戏工程中的SDKManager实现即可。


## 莫邪聚合SDK与Unity打包工具
* 聚合SDK作用和实现原理
* Unity打包工具的原理及使用
* 向聚合sdk中添加新的渠道或sdk
* 服务器上需要做的处理

# 分包制作
