#### 需求描述

1. 不同级红点状态可传递
2. 同级红点不相互影响
3. 红点状态可配置
4. 红点可记录数量

#### 功能分析

要实现功能传递显然要实现层级结构，同时为了实现同级红点不互相影响那么就像树形结构了，每个红点相当于叶子，叶子只负责存储红点状态信息以及父节点指向。

要实现上述功能点，最少需要两个类，一个负责控制红点UI显示，一个用来管理状态。

#### 功能分点实现

1. UI显示

UI显示上其实只要控制红点的激活状态就行了。

状态管理方面需要红点UI，红点状态即可。

行为方面需要写一个红点开关函数以及用来接受传进来的红点状态的函数。

```c#
public void SetRedPoint(bool flag){
    if(imgRedPoint != null){
        imgRedPoint.gameObject.SetActive(flag);
    }
}
```

```C#
public void SetData(NotifyMark mark){
    if(mark == null){
        SetRedPoint(false);
        return;
    }
    this.mark = mark;
    this.mark.OnChange += SetRedPoint;
}
```

2. 红点状态管理

红点状态管理方面稍微复杂点：需要定义一个父节点，方便红点状态的层级传递；

​							定义一个消息数，方便消息分层；

​							定义一个状态标志，界定当前状态，通过使用属性来定义

​							定义一个状态变更代理，方便状态变更时让UI层随之变化

行为方面：状态获取(getter)；

​		    父节点设置；

​		    设置状态变更代理；

​		    红点状态变更；

​		    父节点状态变更；

​		    状态重置；

​		    子节点状态清除。

```C#
public class NotifyMark {

		private NotifyMark parentNode = null;
		private int SubNotifyCount = 0;

		/* 判断通知是否显示 */
		public bool IsNotify { get; private set; }
		public static implicit operator bool (NotifyMark notify) { //定义隐式转换
			return notify != null && notify.IsNotify;
		}

		/* 设置状态变更代理 */
		private Action<bool> _OnChange = null; //定义bool类型，用来确定是否显示小红点
		public event Action<bool> OnChange {
			add {
				_OnChange += value;
				value (IsNotify);
			}
			remove {
				_OnChange -= value;
			}
		}

		/* 构造函数初始化状态 */
		public NotifyMark () {
			IsNotify = false;
		}

		/* 设置父节点 */
		public void SetParentNotify (NotifyMark notify) {
			parentNode = notify;
		}

		/* 更新状态 */
		public void ChangeNotify (bool isNotify) {
			if (isNotify != IsNotify) {
				IsNotify = isNotify;

				//如果有父节点就向上传递
				if (parentNode != null) {
					parentNode.OnSubNotifyChange (isNotify);
				}

				// 变更小红点显示
				if (_OnChange != null) {
					_OnChange (IsNotify);
				}
			}
		}

		/* 修改父节点小红点状态 */
		private void OnSubNotifyChange (bool isNotify) {
			if (isNotify) {
				SubNotifyCount++;          //记录子节点消息数量
			} else {
				SubNotifyCount--;
			}
			ChangeNotify (SubNotifyCount > 0);
		}

		/* 清除子节点小红点记录 */
		public void CleanSub () {
			SubNotifyCount = 0;
			ChangeNotify (false);
		}

		/* 重置信息 */
		public void Reset () {
			parentNode = null;
			SubNotifyCount = 0;
			ChangeNotify (false);
			_OnChange = null;
		}
	}
```

3. 用例

实质是通过给ChangeNotify传递判断值。

**例子：**

见demo

