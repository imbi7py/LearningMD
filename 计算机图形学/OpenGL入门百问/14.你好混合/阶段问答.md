### 关键词

透明度，颜色混合，渲染顺序，*次序无关透明度

### 如何使用alpha值实现透明

使用alpha值来实现透明也叫做**透明度测试**，只不过这个测试是我们在片段着色器中手动去做的一个判断，结合`discard`指令来抛弃片段。这种方式来实现透明有些非黑即白。

这种方式需要纹理是拥有全部4个颜色分量的，变更在加载的时候指定`GL_RGBA`

### 哪些方式可以影响混合结果

$$
\begin{equation}\bar{C}_{result} = \bar{\color{green}C}_{source} * \color{green}F_{source} + \bar{\color{red}C}_{destination} * \color{red}F_{destination}\end{equation}
$$

上述是OpenGL使用的混合方程

1. 控制因子：`glBlendFunc`提供的是对两个乘数因子的设置。两个参数中，前一个代表`alpha`值对源颜色的影响，后一个代表对目标颜色的影响。
2. 另外，可以通过`glBlendEuqaltion`来设置两个分量之间的运算。

### 为什么深度测试会影响混合

因为深度测试不检查片段是否透明，只检查深度值。所以渲染透明物体时**渲染顺序**尤为重要，另外还得关闭半透明物体的深度写入。

- 为什么要关闭深度写入？

  如果不关闭，后渲染出来的半透明物体出现在更前方的位置时会更新深度缓冲，导致后方物体被剔除。

- 为什么顺序重要？

  由于关闭了深度写入导致深度测试机制被破坏，在渲染这个`半透明物体A`的时候并不会去刷新深度缓冲。渲染`后续物体B`的时候，如果B在A后面，就会发现B却把A挡住了。

当绘制一个有不透明和透明物体的场景的时候，大体的原则如下：

1. 先绘制所有不透明的物体。
2. 对所有透明的物体排序。
3. 按顺序绘制所有透明的物体。